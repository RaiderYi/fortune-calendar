# 基于八字命理的个性化日历应用 - 完整实施计划

## 📋 项目定位

**核心目标**：打造一个以八字命理为基础框架的个性化万年历应用，而非单纯的命理判断工具。通过用户的八字信息生成专属的日程建议、运势提示及个性化内容推荐。

## 🎯 实施策略（基于方案一：lunar-python 扩展）

### 阶段一：核心算法模块重构（1-2周）

#### 1.1 创建独立的八字计算模块

**新建文件**：`api/bazi_calculator.py`

* 封装所有八字计算逻辑

* 提供清晰的函数接口

* 保持与现有 API 的兼容性

**核心功能**：

* 完整四柱八字排盘（年月日时）

* 日主旺衰分析

* 用神喜忌推导

* 大运流年流月排盘

* 五行生克分析

* 神煞计算

#### 1.2 实现用神喜忌算法

**算法逻辑**：

1. **日主旺衰判断**（权重分配）：

   * 月令（45%）：判断日主在月令中的状态

   * 得令（30%）：其他地支对日主的生克

   * 得地（15%）：天干对日主的生克

   * 得势（10%）：整体格局分析

2. **用神推导**：

   * 身旺：取泄耗之神为用神（食伤、财星）

   * 身弱：取生扶之神为用神（印星、比劫）

   * 从格：取从神为用神

3. **喜忌确定**：

   * 喜神：生扶用神的五行

   * 忌神：克制用神的五行

#### 1.3 实现大运流年流月排盘

**利用 lunar-python 功能**：

* `getYun()` - 获取运程信息

* `getDaYun()` - 获取大运列表

* 为目标日期计算流年、流月、流日八字

#### 1.4 实现五行生克分析

**生克关系配置**：

* 木生火、火生土、土生金、金生水、水生木

* 木克土、土克水、水克火、火克金、金克木

**分析维度**：

* 原局五行分布

* 大运五行影响

* 流年流月流日五行与用神的关系

* 五行流通性判断

#### 1.5 实现神煞计算

**常用神煞**：

* 桃花、贵人、文昌、驿马

* 羊刃、亡神、华盖等

* 利用 `getShenSha()` 获取

### 阶段二：动态评分系统（1周）

#### 2.1 基于用神的综合评分算法

**评分公式**：

```
总分 = 基础分(60) + 用神加分 + 喜神加分 - 忌神减分 + 神煞加成 + 五行流通加成
```

**各维度评分**：

* 事业：看官杀、印星与用神关系

* 财运：看财星与用神关系

* 情感：看桃花、官杀与用神关系

* 健康：看五行流通、冲克情况

* 学业：看文昌、印星与用神关系

* 出行：看驿马、冲克情况

#### 2.2 个性化日程建议生成

**基于每日八字生成**：

* 宜：根据用神喜神推荐活动

* 忌：根据忌神冲克提醒避免事项

* 最佳时间：根据时辰五行推荐

### 阶段三：日历功能深度融合（1-2周）

#### 3.1 优化现有 API 接口

**修改文件**：`api/index.py`

* 集成新的八字计算模块

* 返回更完整的八字信息

* 添加大运流年流月数据

* 返回用神喜忌信息

* 返回神煞信息

* 返回详细的评分依据

#### 3.2 前端功能扩展

**修改文件**：`src/App.tsx`

* 添加八字详情展示（四柱八字）

* 添加用神喜忌展示

* 添加大运信息展示

* 添加神煞信息展示

* 优化日程建议展示

* 添加评分详情说明

#### 3.3 个性化内容推荐

**基于八字特征推荐**：

* 日程建议：根据每日八字推荐活动

* 运势提示：根据大运流年流月变化提示

* 个性化标签：根据八字特征生成

### 阶段四：测试与优化（持续）

#### 4.1 算法准确性测试

* 对比专业八字排盘结果

* 验证用神推导准确性

* 验证评分合理性

#### 4.2 用户体验优化

* 优化加载速度

* 优化界面展示

* 添加解释说明

## 📁 文件结构

```
api/
├── index.py              # 主 API 接口（修改）
├── bazi_calculator.py    # 八字计算模块（新建）
├── config.py             # 配置文件（新建）
└── utils.py              # 工具函数（新建）

src/
├── App.tsx              # 主组件（修改）
├── components/           # 新增组件目录
│   ├── BaziDetail.tsx   # 八字详情组件
│   ├── YunInfo.tsx      # 大运信息组件
│   └── ShenSha.tsx      # 神煞信息组件
└── types.ts             # 类型定义（新建）
```

## 🔧 核心技术要点

### 1. 日主旺衰判断

```python
def analyze_day_master_strength(bazi):
    """
    分析日主旺衰
    返回: 身旺/身弱/从格
    """
    # 月令权重 45%
    # 得令权重 30%
    # 得地权重 15%
    # 得势权重 10%
    pass
```

### 2. 用神推导

```python
def derive_yong_shen(bazi, strength):
    """
    推导用神喜忌
    返回: {
        'yong_shen': ['水', '木'],
        'xi_shen': ['水'],
        'ji_shen': ['火', '土']
    }
    """
    pass
```

### 3. 流年流月流日分析

```python
def analyze_liu_nian(user_bazi, target_date, da_yun):
    """
    分析流年运势
    返回: 流年八字、与用神关系、评分、建议
    """
    pass
```

### 4. 综合评分

```python
def calculate_fortune_score(user_bazi, target_date, da_yun, yong_shen):
    """
    计算综合运势评分
    返回: 总分、各维度评分、评分依据
    """
    pass
```

## ✅ 验收标准

1. **算法完整性**

   * ✅ 完整四柱八字排盘

   * ✅ 用神喜忌推导准确

   * ✅ 大运流年流月排盘完整

   * ✅ 五行生克分析准确

   * ✅ 神煞计算完整

2. **功能完整性**

   * ✅ 八字详情展示

   * ✅ 用神喜忌展示

   * ✅ 大运信息展示

   * ✅ 神煞信息展示

   * ✅ 个性化日程建议

3. **用户体验**

   * ✅ 界面美观易用

   * ✅ 加载速度快

   * ✅ 信息清晰易懂

   * ✅ 评分合理可信

4. **代码质量**

   * ✅ 模块化设计

   * ✅ 代码可维护

   * ✅ 注释完整

   * ✅ 测试覆盖

## 📊 预期成果

完成本计划后，将实现：

1. **完整的八字命理算法闭环**
2. **基于八字的个性化日历应用**
3. **准确的用神喜忌分析**
4. **动态的运势评分系统**
5. **个性化的日程建议**
6. **专业的八字信息展示**

