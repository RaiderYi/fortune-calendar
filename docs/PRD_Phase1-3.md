# å‘½è¿æ—¥å†äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰
## Phase 1-3 å®Œæ•´è§„åˆ’

**ç‰ˆæœ¬**: v1.0  
**ç¼–å†™æ—¥æœŸ**: 2026-02-11  
**é€‚ç”¨é˜¶æ®µ**: Phase 1 (M1-M2) â†’ Phase 2 (M2-M3) â†’ Phase 3 (M3-M4)  

---

## ç›®å½•

1. [Phase 1: æ ¸å¿ƒä½“éªŒä¼˜åŒ–](#phase-1-æ ¸å¿ƒä½“éªŒä¼˜åŒ–-m1-m2)
2. [Phase 2: å˜ç°ä½“ç³»](#phase-2-å˜ç°ä½“ç³»-m2-m3)
3. [Phase 3: å†…å®¹ç”Ÿæ€](#phase-3-å†…å®¹ç”Ÿæ€-m3-m4)
4. [æŠ€æœ¯å®ç°æ–¹æ¡ˆ](#æŠ€æœ¯å®ç°æ–¹æ¡ˆ)
5. [æ•°æ®åŸ‹ç‚¹ä¸æŒ‡æ ‡ä½“ç³»](#æ•°æ®åŸ‹ç‚¹ä¸æŒ‡æ ‡ä½“ç³»)
6. [é£é™©æ§åˆ¶ä¸å›æ»šæ–¹æ¡ˆ](#é£é™©æ§åˆ¶ä¸å›æ»šæ–¹æ¡ˆ)

---

# Phase 1: æ ¸å¿ƒä½“éªŒä¼˜åŒ– (M1-M2)

## 1.1 æ¸¸å®¢æ¨¡å¼ä¸Šçº¿

### 1.1.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- æ–°ç”¨æˆ·é¦–æ¬¡è¿›å…¥éœ€å¡«å†™å§“åã€å‡ºç”Ÿæ—¥æœŸã€å‡ºç”Ÿåœ°ã€å‡ºç”Ÿæ—¶é—´ï¼Œä¿¡æ¯æ”¶é›†è¿‡é‡
- æ•°æ®ç»Ÿè®¡æ˜¾ç¤ºï¼Œçº¦ 60% ç”¨æˆ·åœ¨ä¿¡æ¯å¡«å†™é¡µé¢æµå¤±
- ç”¨æˆ·æ— æ³•å¿«é€Ÿæ„ŸçŸ¥äº§å“ä»·å€¼ï¼Œå†³ç­–æˆæœ¬é«˜

**ç›®æ ‡**:
- è®©ç”¨æˆ·åœ¨ 3 ç§’å†…çœ‹åˆ°äº§å“æ ¸å¿ƒä»·å€¼
- æ–°ç”¨æˆ·æµå¤±ç‡é™ä½ 50%ï¼ˆä» 60% é™è‡³ 30%ï¼‰
- æ¸¸å®¢è½¬æ³¨å†Œç”¨æˆ·è½¬åŒ–ç‡ç›®æ ‡ 20%

### 1.1.2 åŠŸèƒ½éœ€æ±‚

#### FR-GUEST-001: æ¸¸å®¢æ¨¡å¼å…¥å£

**ç”¨æˆ·æ•…äº‹**:  
ä½œä¸ºæ–°ç”¨æˆ·ï¼Œæˆ‘å¸Œæœ›ä¸å¡«å†™ä¸ªäººä¿¡æ¯å°±èƒ½æŸ¥çœ‹ä»Šæ—¥è¿åŠ¿ï¼Œä»¥ä¾¿å¿«é€Ÿäº†è§£äº§å“ä»·å€¼ã€‚

**éªŒæ”¶æ ‡å‡†**:

| ç¼–å· | éªŒæ”¶é¡¹ | ä¼˜å…ˆçº§ | éªŒæ”¶æ ‡å‡† |
|------|--------|--------|----------|
| AC-001 | é¦–é¡µå…¥å£ | P0 | é¦–é¡µæä¾›ã€Œæ¸¸å®¢ä½“éªŒã€æŒ‰é’®ï¼Œä½äºã€Œå¼€å§‹æµ‹ç®—ã€ä¸‹æ–¹ï¼Œæ ·å¼ä¸ºæ–‡å­—é“¾æ¥ |
| AC-002 | å…¥å£æ–‡æ¡ˆ | P0 | æŒ‰é’®æ–‡æ¡ˆï¼šã€Œå…ˆçœ‹çœ‹ä»Šæ—¥è¿åŠ¿ â†’ã€ï¼Œç‚¹å‡»åè¿›å…¥æ¸¸å®¢æ¨¡å¼ |
| AC-003 | å…¥å£é™åˆ¶ | P0 | æ¸¸å®¢æ¨¡å¼ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·æ•°æ®ï¼Œé€€å‡ºåæ¸…ç©º |

**ç•Œé¢åŸå‹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‘½è¿æ—¥å†                  â”‚
â”‚                                     â”‚
â”‚    [Logo/ä¸»è§†è§‰å›¾]                  â”‚
â”‚                                     â”‚
â”‚         æ¢ç´¢ä½ çš„è¿åŠ¿å¯†ç             â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚     å¼€å§‹æµ‹ç®—            â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â”‚
â”‚    å…ˆçœ‹çœ‹ä»Šæ—¥è¿åŠ¿ â†’                 â”‚  â† æ¸¸å®¢å…¥å£
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-GUEST-002: æ¸¸å®¢è¿åŠ¿å±•ç¤º

**åŠŸèƒ½æè¿°**:  
åŸºäºå½“å¤©æ—¥æœŸç”Ÿæˆã€Œé€šç”¨è¿åŠ¿ã€ï¼Œä¸ä¾èµ–ä¸ªäººå…«å­—ï¼Œä½†æä¾›åˆç†çš„è¿åŠ¿å‚è€ƒã€‚

**ç®—æ³•ç­–ç•¥**:
```python
def generate_guest_fortune(date: datetime) -> Fortune:
    """
    æ¸¸å®¢æ¨¡å¼è¿åŠ¿ç”Ÿæˆç®—æ³•
    1. åŸºäºå½“æ—¥å¹²æ”¯è®¡ç®—å¤©æ—¶è¿åŠ¿
    2. ç»“åˆæ˜ŸæœŸå‡ ã€èŠ‚æ°”ç­‰å› ç´ 
    3. ç”Ÿæˆå…­ç»´è¯„åˆ†çš„ç›¸å¯¹é«˜ä½ï¼Œè€Œéç»å¯¹å€¼
    """
    base_score = calculate_day_energy(date)  # åŸºäºå½“æ—¥å¹²æ”¯
    
    # å…­ç»´è¿åŠ¿ï¼ˆä½¿ç”¨ç›¸å¯¹è¶‹åŠ¿è€Œéç»å¯¹åˆ†æ•°ï¼‰
    dimensions = {
        'career': base_score + random_offset(-5, 5),
        'wealth': base_score + random_offset(-8, 8),
        'love': base_score + random_offset(-10, 10),
        'health': base_score + random_offset(-3, 3),
        'study': base_score + random_offset(-7, 7),
        'travel': base_score + random_offset(-6, 6),
    }
    
    # ç¡®ä¿æœ‰é«˜ä½èµ·ä¼ï¼Œä¸å…¨æ˜¯ç›¸åŒåˆ†æ•°
    adjust_for_variety(dimensions)
    
    return Fortune(dimensions=dimensions, is_guest=True)
```

**å±•ç¤ºå†…å®¹**:

| æ¨¡å— | å†…å®¹ | è¯´æ˜ |
|------|------|------|
| ä»Šæ—¥æ—¥æœŸ | å…¬å† + å†œå† + å¹²æ”¯ | åŸºç¡€ä¿¡æ¯ |
| è¿åŠ¿æ€»è¯„ | ä¸€å¥è¯æ€»ç»“ | å¦‚ã€Œä»Šæ—¥å®œé™ä¸å®œåŠ¨ï¼Œè´¢è¿å¹³ç¨³ã€ |
| å…­ç»´é›·è¾¾å›¾ | äº‹ä¸š/è´¢è¿/æ¡ƒèŠ±/å¥åº·/å­¦ä¸š/å‡ºè¡Œ | ç›¸å¯¹è¯„åˆ†ï¼ˆ60-85åˆ†åŒºé—´ï¼‰ |
| ä»Šæ—¥å®œå¿Œ | 3æ¡å®œ + 3æ¡å¿Œ | é€šç”¨å»ºè®® |
| æ—¶è¾°å‰å‡¶ | 24å°æ—¶æ—¶è¾°åˆ†å¸ƒ | å±•ç¤ºå‰å‡¶æ—¶è¾° |
| ä¸»é¢˜è‰² | æ ¹æ®å½“æ—¥äº”è¡Œ | é¡µé¢æ•´ä½“è‰²è°ƒ |

**æ¸¸å®¢ vs æ³¨å†Œç”¨æˆ·å·®å¼‚**:

| åŠŸèƒ½ | æ¸¸å®¢æ¨¡å¼ | æ³¨å†Œç”¨æˆ· |
|------|----------|----------|
| è¿åŠ¿ç²¾åº¦ | é€šç”¨ï¼ˆåŸºäºæ—¥æœŸï¼‰ | ä¸ªäººå…«å­—å®šåˆ¶ |
| å…­ç»´åˆ†æ•° | 60-85åˆ†åŒºé—´ | çœŸå®è®¡ç®— 0-100 |
| æµå¹´åˆ†æ | âŒ | âœ… |
| åå¹´å¤§è¿ | âŒ | âœ… |
| AIå’¨è¯¢ | âŒ | âœ… |
| æ—¥ç­¾ç”Ÿæˆ | âœ…ï¼ˆå¸¦æ°´å°ï¼‰ | âœ…ï¼ˆæ— æ°´å°ï¼‰ |
| å†å²è®°å½• | âŒ | âœ… |

#### FR-GUEST-003: æ¸¸å®¢è½¬æ³¨å†Œå¼•å¯¼

**è§¦å‘æ—¶æœº**:
1. ç”¨æˆ·ç‚¹å‡»ã€Œæµå¹´åˆ†æã€ç­‰é«˜çº§åŠŸèƒ½æ—¶
2. ç”¨æˆ·ç‚¹å‡»ã€Œä¿å­˜æ—¥ç­¾ã€æ—¶
3. ç”¨æˆ·åœ¨é¡µé¢åœç•™è¶…è¿‡ 2 åˆ†é’Ÿæ—¶ï¼ˆè½¯å¼•å¯¼ï¼‰

**å¼•å¯¼ç­–ç•¥**:

| æ—¶æœº | å¼•å¯¼æ–¹å¼ | æ–‡æ¡ˆ |
|------|----------|------|
| åŠŸèƒ½æ‹¦æˆª | å¼¹çª— | ã€Œæ­¤åŠŸèƒ½éœ€è¦æ‚¨çš„ç”Ÿè¾°å…«å­—æ‰èƒ½å‡†ç¡®æµ‹ç®—ï¼Œå¡«å†™ä»…éœ€30ç§’ã€ |
| ä¿å­˜æ‹¦æˆª | å¼¹çª— | ã€Œä¿å­˜ä¸ªæ€§åŒ–æ—¥ç­¾éœ€è¦å…ˆåˆ›å»ºæ¡£æ¡ˆå“¦ã€ |
| è½¯å¼•å¯¼ | åº•éƒ¨æç¤ºæ¡ | ã€Œè¾“å…¥æ‚¨çš„ç”Ÿè¾°ï¼Œè·å–ä¸“å±è¿åŠ¿è§£è¯» â†’ã€ |

**è½¬åŒ–æ¼æ–—ä¼˜åŒ–**:

```
æ¸¸å®¢è¿›å…¥ â†’ æŸ¥çœ‹é€šç”¨è¿åŠ¿ â†’ è§¦å‘å¼•å¯¼ â†’ å¡«å†™ä¿¡æ¯ â†’ æ³¨å†ŒæˆåŠŸ
   â”‚              â”‚              â”‚           â”‚         â”‚
   â”‚              â”‚              â”‚           â”‚         â””â”€â”€ ç›®æ ‡20%
   â”‚              â”‚              â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç›®æ ‡60%
   â”‚              â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç›®æ ‡70%
   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç›®æ ‡80%
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 100%
```

### 1.1.3 æŠ€æœ¯éœ€æ±‚

#### TR-GUEST-001: æ•°æ®å­˜å‚¨

```typescript
// æ¸¸å®¢æ¨¡å¼ä½¿ç”¨ sessionStorageï¼Œå…³é—­é¡µé¢å³æ¸…é™¤
interface GuestSession {
  sessionId: string;
  enterTime: Date;
  viewCount: number;
  fortuneData: GuestFortune | null;
}

// è‹¥ç”¨æˆ·æ³¨å†Œï¼Œè¿ç§»æ•°æ®åˆ° localStorage
function migrateGuestToUser(guestData: GuestSession, userProfile: UserProfile): void;
```

#### TR-GUEST-002: API æ¥å£

```python
# æ–°å¢ API ç«¯ç‚¹
GET /api/guest/fortune?date=YYYY-MM-DD

Response:
{
    "success": true,
    "data": {
        "date": "2026-02-11",
        "lunar": "æ­£æœˆå»¿å››",
        "ganzhi": "ä¸™åˆå¹´ åºšå¯…æœˆ å£¬æˆŒæ—¥",
        "overall": "ä»Šæ—¥å®œé™ä¸å®œåŠ¨ï¼Œè´¢è¿å¹³ç¨³",
        "dimensions": {
            "career": 72,
            "wealth": 68,
            "love": 75,
            "health": 80,
            "study": 70,
            "travel": 65
        },
        "yi": ["ç­¾çº¦", "æ±‚èŒ", "å­¦ä¹ "],
        "ji": ["æ¬å®¶", "æŠ•èµ„", "äº‰åµ"],
        "hourly": [
            {"hour": "23-01", "name": "å­æ—¶", "luck": "å‰"},
            // ...
        ],
        "themeColor": "#8B4513",
        "isGuest": true
    }
}
```

### 1.1.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `guest_enter` | `{source: 'é¦–é¡µæŒ‰é’®' \| 'URLç›´æ¥è¿›å…¥'}` | è¿›å…¥æ¸¸å®¢æ¨¡å¼ |
| `guest_fortune_view` | `{stay_time: number}` | æŸ¥çœ‹è¿åŠ¿ |
| `guest_convert_show` | `{trigger: 'åŠŸèƒ½æ‹¦æˆª' \| 'ä¿å­˜æ‹¦æˆª' \| 'è½¯å¼•å¯¼'}` | å±•ç¤ºè½¬åŒ–å¼•å¯¼ |
| `guest_convert_click` | `{trigger: string}` | ç‚¹å‡»è½¬åŒ–æŒ‰é’® |
| `guest_register_success` | `{time_spent: number}` | æ³¨å†ŒæˆåŠŸ |
| `guest_exit` | `{duration: number, max_scroll: number}` | ç¦»å¼€æ¸¸å®¢æ¨¡å¼ |

---

## 1.2 æ—¥ç­¾åˆ†äº«ä¼˜åŒ–

### 1.2.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- å½“å‰æ—¥ç­¾æ ·å¼å•ä¸€ï¼Œç¼ºä¹åˆ†äº«å¸å¼•åŠ›
- åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“åè¢«å‹ç¼©ï¼Œè§†è§‰æ•ˆæœå·®
- ç¼ºå°‘ UGC å…ƒç´ ï¼Œç”¨æˆ·å‚ä¸åº¦ä½

**ç›®æ ‡**:
- æ—¥ç­¾åˆ†äº«ç‡æå‡ 3 å€ï¼ˆä» 5% æå‡è‡³ 15%ï¼‰
- é€šè¿‡åˆ†äº«å¸¦æ¥æ–°ç”¨æˆ·å æ¯”è¾¾åˆ° 20%
- ç”¨æˆ·ç”Ÿæˆå†…å®¹ï¼ˆå¿ƒæƒ…/ç›®æ ‡ï¼‰ä½¿ç”¨ç‡ 30%

### 1.2.2 åŠŸèƒ½éœ€æ±‚

#### FR-CARD-001: å¤šé£æ ¼æ—¥ç­¾æ¨¡æ¿

**æ¨¡æ¿åº“**:

| æ¨¡æ¿åç§° | é£æ ¼ | é€‚ç”¨åœºæ™¯ | è®¾è®¡è¦ç‚¹ |
|----------|------|----------|----------|
| æ°´å¢¨æ±Ÿå— | å¤é£ | é€šç”¨ | æ°´å¢¨èƒŒæ™¯ã€ä¹¦æ³•å­—ä½“ã€å°ç« å…ƒç´  |
| ç°ä»£æç®€ | ç®€çº¦ | èŒåœºäººç¾¤ | çº¯è‰²èƒŒæ™¯ã€æ— è¡¬çº¿å­—ä½“ã€ç•™ç™½è®¾è®¡ |
| é”¦é²¤å¥½è¿ | å–œåº† | è´¢è¿/å¥½è¿æ—¥ | é”¦é²¤å›¾æ¡ˆã€çº¢è‰²ä¸»è°ƒã€é‡‘è‰²ç‚¹ç¼€ |
| æ˜Ÿç©ºå¡”ç½— | ç¥ç§˜ | æ¡ƒèŠ±/å§»ç¼˜æ—¥ | æ˜Ÿç©ºèƒŒæ™¯ã€æ˜Ÿåº§å…ƒç´ ã€æ¸å˜è‰² |
| æ—¥å¼æ²»æ„ˆ | æ¸…æ–° | å¥åº·/å¹³å®‰æ—¥ | å’Œé£å›¾æ¡ˆã€æŸ”å’Œè‰²è°ƒã€æ’ç”»é£æ ¼ |
| èµ›åšæœ‹å…‹ | æ½®æµ | å¹´è½»ç”¨æˆ· | éœ“è™¹å…‰æ•ˆã€ç§‘æŠ€æ„Ÿå­—ä½“ã€æ·±è‰²èƒŒæ™¯ |

**æ¨¡æ¿é€‰æ‹©ç•Œé¢**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©æ—¥ç­¾é£æ ¼          [å…³é—­]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [æ°´å¢¨] [æç®€] [é”¦é²¤] [æ˜Ÿç©º]        â”‚
â”‚  [æ²»æ„ˆ] [èµ›åš]                      â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚      [æ—¥ç­¾é¢„è§ˆå›¾]           â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  [ç”Ÿæˆæ—¥ç­¾]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯å®ç°**:
```typescript
// æ¨¡æ¿é…ç½®
interface CardTemplate {
  id: string;
  name: string;
  style: 'traditional' | 'minimal' | 'festive' | 'mystic' | 'healing' | 'cyber';
  background: string; // èƒŒæ™¯å›¾ç‰‡/æ¸å˜
  fonts: {
    title: string;
    body: string;
    number: string;
  };
  colors: {
    primary: string;
    secondary: string;
    text: string;
    accent: string;
  };
  elements: {
    showLogo: boolean;
    showDate: boolean;
    showGanzhi: boolean;
    showDimension: boolean;
    showYiJi: boolean;
    showQuote: boolean;
  };
}

// æ¨¡æ¿æ¸²æŸ“
function renderCardToImage(
  fortuneData: FortuneData,
  template: CardTemplate,
  customText?: string
): Promise<Blob>;
```

#### FR-CARD-002: UGC å†…å®¹æ·»åŠ 

**å¯æ·»åŠ å…ƒç´ **:

| å…ƒç´  | è¾“å…¥æ–¹å¼ | å­—æ•°é™åˆ¶ | ç¤ºä¾‹ |
|------|----------|----------|------|
| ä»Šæ—¥å¿ƒæƒ… | è¡¨æƒ…é€‰æ‹© + æ–‡å­— | 20å­— | ã€Œå……æ»¡å¸Œæœ› ğŸ˜Šã€ |
| ä»Šæ—¥ç›®æ ‡ | æ–‡æœ¬è¾“å…¥ | 30å­— | ã€Œå®Œæˆé¡¹ç›®ææ¡ˆã€ |
| å¹¸è¿å®£è¨€ | é¢„è®¾æ–‡æ¡ˆé€‰æ‹© | - | ã€Œä»Šå¤©ä¹Ÿæ˜¯å¹¸è¿çš„ä¸€å¤©ã€ |
| ç¥ˆç¦è¯­ | é¢„è®¾æ–‡æ¡ˆé€‰æ‹© | - | ã€Œå®¶äººå¹³å®‰å¥åº·ã€ |

**å¿ƒæƒ…è¡¨æƒ…åº“**:
```
ğŸ˜Š å¼€å¿ƒ  ğŸ˜” ä½è½  ğŸ˜¤ å¥‹æ–—  ğŸ¥° å¹¸ç¦  
ğŸ¤” æ€è€ƒ  ğŸ˜ è‡ªä¿¡  ğŸ™ ç¥ˆç¥·  âœ¨ æœŸå¾…
```

#### FR-CARD-003: å¤šå¹³å°åˆ†äº«é€‚é…

**å¹³å°å°ºå¯¸è§„èŒƒ**:

| å¹³å° | å°ºå¯¸ | ç‰¹æ®Šè¦æ±‚ |
|------|------|----------|
| å¾®ä¿¡æœ‹å‹åœˆ | 1080Ã—1920 (9:16) | é¡¶éƒ¨ç•™å®‰å…¨åŒºï¼Œé¿å…è¢«é®æŒ¡ |
| å°çº¢ä¹¦ | 1080Ã—1440 (3:4) | é€‚åˆç«–å±æµè§ˆ |
| å¾®åš | 1080Ã—1080 (1:1) | æ­£æ–¹å½¢ï¼Œé€‚é…ä¿¡æ¯æµ |
| ä¿å­˜æœ¬åœ° | 1080Ã—1920 | é«˜æ¸…åŸå›¾ |

**åˆ†äº«æµç¨‹**:

```
ç”Ÿæˆæ—¥ç­¾ â†’ é€‰æ‹©å¹³å° â†’ é¢„è§ˆ/ç¼–è¾‘ â†’ åˆ†äº«/ä¿å­˜
    â”‚          â”‚           â”‚           â”‚
    â”‚          â”‚           â”‚           â”œâ”€â”€ å”¤èµ·å¾®ä¿¡åˆ†äº«
    â”‚          â”‚           â”‚           â”œâ”€â”€ å”¤èµ·å¾®åšåˆ†äº«
    â”‚          â”‚           â”‚           â””â”€â”€ ä¸‹è½½åˆ°æœ¬åœ°
    â”‚          â”‚           â”‚
    â”‚          â”‚           â””â”€â”€ æ·»åŠ æ–‡å­—/è°ƒæ•´ä½ç½®
    â”‚          â”‚
    â”‚          â””â”€â”€ å¾®ä¿¡/å¾®åš/å°çº¢ä¹¦/ä¿å­˜
    â”‚
    â””â”€â”€ é€‰æ‹©æ¨¡æ¿ â†’ æ·»åŠ UGCå†…å®¹ â†’ ç”Ÿæˆé¢„è§ˆ
```

#### FR-CARD-004: åˆ†äº«å¼•å¯¼ä¸æ¿€åŠ±

**åˆ†äº«åå›æµ**:
```
ç”¨æˆ·Aåˆ†äº«æ—¥ç­¾åˆ°æœ‹å‹åœˆ
    â”‚
    â”œâ”€â”€ æ—¥ç­¾åº•éƒ¨å¸¦å°ç¨‹åºç /äºŒç»´ç 
    â”‚
    â””â”€â”€ ç”¨æˆ·Bæ‰«ç è¿›å…¥
            â”‚
            â”œâ”€â”€ ç›´æ¥æŸ¥çœ‹ç”¨æˆ·Açš„æ—¥ç­¾
            â”œâ”€â”€ æ˜¾ç¤ºã€Œæˆ‘ä¹Ÿæƒ³ç”Ÿæˆæˆ‘çš„æ—¥ç­¾ã€æŒ‰é’®
            â””â”€â”€ ç‚¹å‡»è¿›å…¥æ¸¸å®¢æ¨¡å¼/æ³¨å†Œæµç¨‹
```

**åˆ†äº«æ¿€åŠ±**ï¼ˆå¯é€‰ï¼‰:
- åˆ†äº«æ»¡ 3 æ¬¡è§£é”æ–°æ¨¡æ¿
- åˆ†äº«è·å¾—ç§¯åˆ†ï¼Œç§¯åˆ†å…‘æ¢ä¼šå‘˜å¤©æ•°

### 1.2.3 æŠ€æœ¯éœ€æ±‚

#### TR-CARD-001: å›¾ç‰‡ç”Ÿæˆä¼˜åŒ–

```typescript
// ä½¿ç”¨ html-to-image ä¼˜åŒ–ç”Ÿæˆæ€§èƒ½
import { toPng, toJpeg } from 'html-to-image';

interface CardGenerationOptions {
  quality: number;      // å›¾ç‰‡è´¨é‡ 0-1
  pixelRatio: number;   // è®¾å¤‡åƒç´ æ¯”ï¼Œé»˜è®¤ 2
  backgroundColor: string;
  skipFonts?: boolean;  // è·³è¿‡å­—ä½“åŠ è½½ï¼ˆç¼“å­˜æ—¶ï¼‰
}

// æ€§èƒ½ä¼˜åŒ–ï¼šæ¨¡æ¿é¢„æ¸²æŸ“ + ç¼“å­˜
const templateCache = new Map<string, HTMLCanvasElement>();

async function generateCard(
  container: HTMLElement,
  options: CardGenerationOptions
): Promise<Blob> {
  // 1. åŠ è½½å­—ä½“ï¼ˆé¦–æ¬¡ï¼‰
  // 2. æ¸²æŸ“ DOM
  // 3. è½¬æ¢ä¸ºå›¾ç‰‡
  // 4. å‹ç¼©ä¼˜åŒ–
  // 5. è¿”å› Blob
}
```

#### TR-CARD-002: æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆå¤‡é€‰ï¼‰

å¯¹äºæ€§èƒ½è¾ƒå·®çš„è®¾å¤‡ï¼Œæä¾›æœåŠ¡ç«¯ç”Ÿæˆæ–¹æ¡ˆï¼š

```python
# API: POST /api/card/generate
{
    "template_id": "ink_wash",
    "fortune_data": {...},
    "custom_text": "ä»Šæ—¥å¿ƒæƒ…: å……æ»¡å¸Œæœ›",
    "platform": "wechat"  # wechat | xiaohongshu | weibo
}

Response:
{
    "success": true,
    "data": {
        "image_url": "https://cdn.example.com/cards/xxx.png",
        "expires_at": "2026-02-11T23:59:59Z"
    }
}
```

### 1.2.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `card_template_select` | `{template_id: string}` | é€‰æ‹©æ¨¡æ¿ |
| `card_custom_add` | `{type: 'å¿ƒæƒ…' \| 'ç›®æ ‡' \| 'å®£è¨€'}` | æ·»åŠ UGCå†…å®¹ |
| `card_generate` | `{template_id: string, duration: number}` | ç”Ÿæˆæ—¥ç­¾ |
| `card_share_click` | `{platform: string}` | ç‚¹å‡»åˆ†äº« |
| `card_share_success` | `{platform: string}` | åˆ†äº«æˆåŠŸ |
| `card_download` | - | ä¸‹è½½åˆ°æœ¬åœ° |
| `card_entry_share` | `{source_user_id: string}` | é€šè¿‡åˆ†äº«è¿›å…¥ |

---

## 1.3 æ¨é€ç³»ç»Ÿæ­å»º

### 1.3.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- ç”¨æˆ·æ‰“å¼€ App é¢‘ç‡ä½ï¼Œä»…åœ¨æƒ³èµ·æ—¶æŸ¥çœ‹è¿åŠ¿
- ç¼ºä¹ä¸»åŠ¨è§¦è¾¾ç”¨æˆ·çš„æ¸ é“
- ç”¨æˆ·ç²˜æ€§ä¸è¶³ï¼Œæ¬¡æ—¥ç•™å­˜ç‡ä½

**ç›®æ ‡**:
- æ¨é€æ‰“å¼€ç‡è¾¾åˆ° 15%
- æ¨é€å¸¦æ¥çš„æ—¥æ´»æå‡ 30%
- ç”¨æˆ·å…³é—­æ¨é€ç‡ä½äº 10%

### 1.3.2 åŠŸèƒ½éœ€æ±‚

#### FR-PUSH-001: æ¨é€ç±»å‹ä¸æ—¶æœºçš„æ™ºèƒ½ç­–ç•¥

**æ¨é€ç±»å‹çŸ©é˜µ**:

| æ¨é€ç±»å‹ | è§¦å‘æ—¶æœº | ç›®æ ‡ç”¨æˆ· | å†…å®¹ç¤ºä¾‹ |
|----------|----------|----------|----------|
| æ—©æŠ¥ | æ¯æ—¥ 7:00 | æ‰€æœ‰ç”¨æˆ· | ã€Œæ—©å®‰ï¼ä»Šæ—¥è´¢è¿å››æ˜Ÿï¼Œå®œç­¾çº¦ã€ |
| åˆå®‰ | æ¯æ—¥ 12:00 | æ´»è·ƒç”¨æˆ· | ã€Œåˆæ—¶åˆ°ï¼ä»Šæ—¥æ¡ƒèŠ±æ–¹ä½ï¼šä¸œå—ã€ |
| æ™šå®‰ | æ¯æ—¥ 22:00 | æ‰€æœ‰ç”¨æˆ· | ã€Œæ˜æ—¥è¿åŠ¿å·²æ›´æ–°ï¼Œç‚¹å‡»æŸ¥çœ‹ã€ |
| å‰æ—¶æé†’ | ç”¨æˆ·è®¾ç½®çš„æ—¶é—´ | è®¾ç½®è€… | ã€Œ15åˆ†é’Ÿåæ˜¯ä»Šæ—¥æœ€ä½³ç­¾çº¦æ—¶è¾°ã€ |
| èŠ‚æ°”æé†’ | èŠ‚æ°”å½“å¤© | æ‰€æœ‰ç”¨æˆ· | ã€Œç«‹æ˜¥åˆ°ï¼æ–°çš„è¿åŠ¿å‘¨æœŸå¼€å¯ã€ |
| ç”Ÿæ—¥ç‰¹è¾‘ | ç”¨æˆ·ç”Ÿæ—¥å½“å¤© | è¯¥ç”¨æˆ· | ã€Œç”Ÿè¾°å¿«ä¹ï¼æ‚¨çš„ä¸“å±å¹´è¿å·²ç”Ÿæˆã€ |
| è¿åŠ¿çªå˜ | æ£€æµ‹åˆ°è¿åŠ¿éª¤é™æ—¶ | è¯¥ç”¨æˆ· | ã€Œæ˜æ—¥è´¢è¿èµ°ä½ï¼Œæ³¨æ„ç†è´¢ã€ |
| æµå¤±å¬å› | 7å¤©æœªæ‰“å¼€ | æ²‰é»˜ç”¨æˆ· | ã€Œæƒ³ä½ äº†ï¼Œçœ‹çœ‹æœ¬å‘¨è¿åŠ¿å¦‚ä½•ï¼Ÿã€ |

**æ™ºèƒ½æ—¶æœºä¼˜åŒ–**:

```python
def calculate_optimal_push_time(user_id: str) -> datetime:
    """
    åŸºäºç”¨æˆ·è¡Œä¸ºæ•°æ®è®¡ç®—æœ€ä½³æ¨é€æ—¶é—´
    """
    user_behavior = get_user_behavior(user_id)
    
    # åŸºç¡€æ—¶é—´
    base_time = datetime(hour=7, minute=0)
    
    # æ ¹æ®å†å²æ‰“å¼€æ—¶é—´è°ƒæ•´
    avg_open_time = user_behavior.get_avg_open_time()
    if avg_open_time:
        base_time = avg_open_time - timedelta(minutes=15)
    
    # æ ¹æ®ç”¨æˆ·ç±»å‹è°ƒæ•´
    if user_behavior.is_night_owl():
        base_time = datetime(hour=10, minute=0)  # æ™šç¡æ™šèµ·
    
    # å·¥ä½œæ—¥/å‘¨æœ«åŒºåˆ†
    if is_weekend():
        base_time += timedelta(hours=1)  # å‘¨æœ«æ¨è¿Ÿ1å°æ—¶
    
    return base_time
```

#### FR-PUSH-002: æ¨é€å†…å®¹ä¸ªæ€§åŒ–

**å†…å®¹æ¨¡æ¿**:

```typescript
// æ—©æŠ¥æ¨¡æ¿
const morningTemplates = [
  {
    condition: (f: Fortune) => f.wealth >= 80,
    title: "ğŸ’° è´¢è¿çˆ†æ£šçš„ä¸€å¤©",
    body: "ä»Šæ—¥è´¢è¿äº”æ˜Ÿï¼Œé€‚åˆæŠ•èµ„ç†è´¢ã€å•†åŠ¡è°ˆåˆ¤"
  },
  {
    condition: (f: Fortune) => f.love >= 80,
    title: "ğŸ’• æ¡ƒèŠ±æœµæœµå¼€",
    body: "ä»Šæ—¥æ¡ƒèŠ±æ—ºç››ï¼Œå•èº«è€…æ˜“é‡è‰¯ç¼˜"
  },
  {
    condition: (f: Fortune) => f.overall >= 75,
    title: "âœ¨ ä»Šæ—¥è¿åŠ¿æä½³",
    body: "æ•´ä½“è¿åŠ¿å››æ˜ŸåŠï¼Œè¯¸äº‹é¡ºé‚"
  },
  {
    condition: (f: Fortune) => f.overall < 50,
    title: "ğŸŒ± å¹³ç¨³è¿‡æ¸¡çš„ä¸€å¤©",
    body: "ä»Šæ—¥å®œé™ä¸å®œåŠ¨ï¼Œä¿æŒä½è°ƒ"
  },
  {
    condition: () => true,  // é»˜è®¤
    title: "â˜€ï¸ æ—©å®‰ï¼ä»Šæ—¥è¿åŠ¿å·²æ›´æ–°",
    body: "ç‚¹å‡»æŸ¥çœ‹æ‚¨çš„ä¸“å±è¿åŠ¿è§£è¯»"
  }
];

// é€‰æ‹©æœ€ä½³åŒ¹é…æ¨¡æ¿
function selectTemplate(fortune: Fortune): Template {
  return morningTemplates.find(t => t.condition(fortune)) 
      || morningTemplates[morningTemplates.length - 1];
}
```

#### FR-PUSH-003: ç”¨æˆ·æ¨é€è®¾ç½®

**è®¾ç½®é¡¹**:

```typescript
interface PushSettings {
  // æ€»å¼€å…³
  enabled: boolean;
  
  // å„ç±»å‹å¼€å…³
  types: {
    morning: boolean;    // æ—©æŠ¥ï¼Œé»˜è®¤å¼€
    noon: boolean;       // åˆå®‰ï¼Œé»˜è®¤å…³
    evening: boolean;    // æ™šå®‰ï¼Œé»˜è®¤å¼€
    auspicious: boolean; // å‰æ—¶æé†’ï¼Œé»˜è®¤å¼€
    solar: boolean;      // èŠ‚æ°”ï¼Œé»˜è®¤å¼€
    birthday: boolean;   // ç”Ÿæ—¥ï¼Œé»˜è®¤å¼€
  };
  
  // æ—¶é—´åå¥½
  schedule: {
    morningTime: string; // "07:00"
    eveningTime: string; // "22:00"
  };
  
  // å…æ‰“æ‰°
  dnd: {
    enabled: boolean;
    startTime: string;   // "22:00"
    endTime: string;     // "08:00"
  };
}
```

**è®¾ç½®ç•Œé¢**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨é€é€šçŸ¥è®¾ç½®          [ä¿å­˜]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â˜‘ï¸ æ¥æ”¶æ¨é€é€šçŸ¥                    â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ æ¨é€ç±»å‹ â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  â˜‘ï¸ æ¯æ—¥æ—©æŠ¥        [è®¾ç½®æ—¶é—´ â–¶]    â”‚
â”‚     æ¯æ—¥è¿åŠ¿æ¦‚è§ˆæ¨é€                â”‚
â”‚                                     â”‚
â”‚  â˜ åˆå®‰é—®å€™                         â”‚
â”‚     åˆæ—¶è¿åŠ¿æé†’                    â”‚
â”‚                                     â”‚
â”‚  â˜‘ï¸ æ™šå®‰é¢„å‘Š                        â”‚
â”‚     æ˜æ—¥è¿åŠ¿æå‰çœ‹                  â”‚
â”‚                                     â”‚
â”‚  â˜‘ï¸ å‰æ—¶æé†’                        â”‚
â”‚     é‡è¦æ—¶è¾°åŠæ—¶æé†’                â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ å…æ‰“æ‰° â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚                                     â”‚
â”‚  â˜‘ï¸ å¼€å¯å…æ‰“æ‰°                      â”‚
â”‚     22:00 - 08:00 ä¸æ¨é€            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3.3 æŠ€æœ¯éœ€æ±‚

#### TR-PUSH-001: æ¨é€æŠ€æœ¯æ–¹æ¡ˆ

**æ–¹æ¡ˆå¯¹æ¯”**:

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| Web Push (PWA) | å…è´¹ã€åŸç”Ÿæ”¯æŒ | iOS æ”¯æŒæœ‰é™ | PWA ç”¨æˆ· |
| ç¬¬ä¸‰æ–¹æ¨é€ | åˆ°è¾¾ç‡é«˜ã€åŠŸèƒ½ä¸°å¯Œ | éœ€è¦é›†æˆ SDK | æœªæ¥ App åŒ– |
| é‚®ä»¶æ¨é€ | è¦†ç›–å¹¿ã€æˆæœ¬ä½ | æ‰“å¼€ç‡ä½ | æ²‰é»˜ç”¨æˆ·å¬å› |
| çŸ­ä¿¡æ¨é€ | åˆ°è¾¾ç‡æœ€é«˜ | æˆæœ¬é«˜ã€ä½“éªŒå·® | é‡è¦èŠ‚ç‚¹ |

**Phase 1 å®æ–½æ–¹æ¡ˆ**:
```typescript
// 1. PWA Web Push ä¸ºä¸»
// 2. é‚®ä»¶æ¨é€ä½œä¸ºå¤‡é€‰ï¼ˆæ²‰é»˜ç”¨æˆ·ï¼‰

// Service Worker æ¨é€å¤„ç†
self.addEventListener('push', event => {
  const data = event.data.json();
  
  event.waitUntil(
    self.registration.showNotification(data.title, {
      body: data.body,
      icon: '/icons/icon-192x192.png',
      badge: '/icons/badge-72x72.png',
      tag: data.type,  // é˜²æ­¢é‡å¤é€šçŸ¥
      requireInteraction: data.requireInteraction || false,
      data: {
        url: data.url || '/'
      }
    })
  );
});

// ç‚¹å‡»é€šçŸ¥
self.addEventListener('notificationclick', event => {
  event.notification.close();
  
  const url = event.notification.data.url;
  event.waitUntil(
    clients.openWindow(url)
  );
});
```

#### TR-PUSH-002: æœåŠ¡ç«¯æ¨é€è°ƒåº¦

```python
# Vercel Cron Job æˆ–å¤–éƒ¨è°ƒåº¦æœåŠ¡
# vercel.json é…ç½®
{
    "crons": [
        {
            "path": "/api/cron/push-morning",
            "schedule": "0 7 * * *"  # æ¯å¤© 7:00 UTC+8
        },
        {
            "path": "/api/cron/push-evening",
            "schedule": "0 14 * * *"  # æ¯å¤© 22:00 UTC+8
        }
    ]
}

# æ¨é€å¤„ç†é€»è¾‘
class PushService:
    @staticmethod
    def send_morning_push():
        """å‘é€æ—©æŠ¥æ¨é€"""
        users = get_users_with_push_enabled('morning')
        
        for user in users:
            fortune = calculate_fortune(user.birth_data, today())
            template = select_template(fortune)
            
            send_push_notification(
                user_id=user.id,
                title=template.title,
                body=template.body,
                url=f'/fortune/{today()}'
            )
```

### 1.3.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `push_permission_request` | - | è¯·æ±‚æ¨é€æƒé™ |
| `push_permission_grant` | - | ç”¨æˆ·å…è®¸æ¨é€ |
| `push_permission_deny` | - | ç”¨æˆ·æ‹’ç»æ¨é€ |
| `push_receive` | `{type: string}` | æ”¶åˆ°æ¨é€ |
| `push_click` | `{type: string, url: string}` | ç‚¹å‡»æ¨é€ |
| `push_settings_change` | `{setting: string, value: boolean}` | ä¿®æ”¹æ¨é€è®¾ç½® |

---

# Phase 2: å˜ç°ä½“ç³» (M2-M3)

## 2.1 ä¼šå‘˜ä½“ç³»ä¸Šçº¿

### 2.1.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- å½“å‰äº§å“å®Œå…¨å…è´¹ï¼Œç¼ºä¹å¯æŒç»­çš„å•†ä¸šæ¨¡å¼
- éƒ¨åˆ†é«˜çº§åŠŸèƒ½ï¼ˆå¦‚ AI å’¨è¯¢ï¼‰æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦æ”¶å…¥è¦†ç›–
- ç”¨æˆ·ä»˜è´¹æ„æ„¿éœ€è¦åŸ¹å…»

**ç›®æ ‡**:
- ä¼šå‘˜ä»˜è´¹è½¬åŒ–ç‡ 3%
- æœˆä»˜è´¹ç”¨æˆ·ï¼ˆMPUï¼‰è¾¾åˆ° 500+
- æœˆæ”¶å…¥ Â¥10,000+

### 2.1.2 åŠŸèƒ½éœ€æ±‚

#### FR-VIP-001: ä¼šå‘˜ç­‰çº§ä¸æƒç›Š

**ä¼šå‘˜æ–¹æ¡ˆ**:

| ç­‰çº§ | ä»·æ ¼ | å‘¨æœŸ | ç›®æ ‡äººç¾¤ |
|------|------|------|----------|
| æ™®é€šç”¨æˆ· | å…è´¹ | - | ä½“éªŒç”¨æˆ· |
| æœˆå¡ä¼šå‘˜ | Â¥18 | 30å¤© | è½»åº¦ç”¨æˆ· |
| å¹´å¡ä¼šå‘˜ | Â¥128 | 365å¤© | å¿ å®ç”¨æˆ·ï¼ˆçœÂ¥88ï¼‰ |
| ç»ˆèº«ä¼šå‘˜ | Â¥365 | æ°¸ä¹… | æ ¸å¿ƒç²‰ä¸ |

**æƒç›Šå¯¹æ¯”çŸ©é˜µ**:

| åŠŸèƒ½ | å…è´¹ç‰ˆ | æœˆå¡ | å¹´å¡ | ç»ˆèº« |
|------|--------|------|------|------|
| æ¯æ—¥è¿åŠ¿ | åŸºç¡€ | è¯¦ç»†+æ—¶è¾° | è¯¦ç»†+æ—¶è¾° | è¯¦ç»†+æ—¶è¾° |
| å…­ç»´åˆ†æ | åŸºç¡€ | è¯¦ç»†è§£è¯» | è¯¦ç»†è§£è¯» | è¯¦ç»†è§£è¯» |
| æµå¹´åˆ†æ | å½“å¹´æ¦‚è¿° | è¯¦ç»†+æ¯æœˆ | è¯¦ç»†+æ¯æœˆ | è¯¦ç»†+æ¯æœˆ |
| åå¹´å¤§è¿ | âŒ | âœ… | âœ… | âœ… |
| AIå’¨è¯¢ | 3æ¬¡/å¤© | æ— é™æ¬¡ | æ— é™æ¬¡ | æ— é™æ¬¡ |
| AIå“åº”é€Ÿåº¦ | æ™®é€š | ä¼˜å…ˆ | ä¼˜å…ˆ | ä¼˜å…ˆ |
| æ—¥ç­¾æ¨¡æ¿ | 3æ¬¾ | å…¨éƒ¨ | å…¨éƒ¨ | å…¨éƒ¨ |
| æ—¥ç­¾æ°´å° | æœ‰ | æ—  | æ—  | æ—  |
| åˆç›˜åˆ†æ | âŒ | 10æ¬¡/æœˆ | æ— é™æ¬¡ | æ— é™æ¬¡ |
| æ‹©å‰æœåŠ¡ | âŒ | 3æ¬¡/æœˆ | 10æ¬¡/æœˆ | æ— é™æ¬¡ |
| å†å²è®°å½• | 30å¤© | æ— é™ | æ— é™ | æ— é™ |
| ä¸“å±å®¢æœ | âŒ | âŒ | âœ… | âœ… |
| æ–°åŠŸèƒ½ä¼˜å…ˆä½“éªŒ | âŒ | âŒ | âœ… | âœ… |

#### FR-VIP-002: ä¼šå‘˜è´­ä¹°æµç¨‹

**è´­ä¹°å…¥å£**:
1. é¦–é¡µä¼šå‘˜å…¥å£ï¼ˆé»„é‡‘ä½ç½®ï¼‰
2. åŠŸèƒ½é™åˆ¶æ—¶çš„å¼•å¯¼å¼¹çª—
3. ä¸ªäººä¸­å¿ƒä¼šå‘˜ä¸­å¿ƒ
4. AI å’¨è¯¢æ¬¡æ•°ç”¨å°½æ—¶çš„æç¤º

**è´­ä¹°é¡µé¢è®¾è®¡**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¼šå‘˜ä¸­å¿ƒ              [å…³é—­]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚     âœ¨ è§£é”å…¨éƒ¨è¿åŠ¿ç‰¹æƒ âœ¨           â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  æœˆå¡   â”‚  â”‚  å¹´å¡  â”‚  â”‚ ç»ˆèº«   â”‚â”‚
â”‚  â”‚  Â¥18   â”‚  â”‚Â¥128    â”‚  â”‚ Â¥365   â”‚â”‚
â”‚  â”‚        â”‚  â”‚çœÂ¥88   â”‚  â”‚ä¸€æ¬¡è´­ä¹°â”‚â”‚
â”‚  â”‚ 30å¤©   â”‚  â”‚ 365å¤©  â”‚  â”‚ æ°¸ä¹…   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â†‘ é€‰ä¸­çŠ¶æ€                   â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ ä¼šå‘˜ç‰¹æƒ â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  âœ… æ— é™æ¬¡ AI å‘½ç†å’¨è¯¢              â”‚
â”‚  âœ… å…¨éƒ¨ 12 æ¬¾ç²¾ç¾æ—¥ç­¾æ¨¡æ¿          â”‚
â”‚  âœ… è¯¦ç»†çš„åå¹´å¤§è¿åˆ†æ              â”‚
â”‚  âœ… æ— å¹¿å‘Šï¼Œçº¯å‡€ä½“éªŒ                â”‚
â”‚  ...                                â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      ç«‹å³å¼€é€š Â¥18           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ğŸ”’ å®‰å…¨æ”¯ä»˜ Â· éšæ—¶å–æ¶ˆ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¦–æœˆä¼˜æƒ ç­–ç•¥**:
- æ–°ç”¨æˆ·é¦–æœˆ Â¥1 ä½“éªŒï¼ˆ7 å¤©å…è´¹è¯•ç”¨å Â¥1/æœˆï¼Œæ¬¡æœˆæ¢å¤ Â¥18ï¼‰
- å¹´å¡ç”¨æˆ·é¢å¤–èµ é€ 1 ä¸ªæœˆ
- é™æ—¶ä¼˜æƒ å€’è®¡æ—¶ï¼ˆè¥é€ ç´§è¿«æ„Ÿï¼‰

#### FR-VIP-003: æ”¯ä»˜ä¸è®¢å•ç®¡ç†

**æ”¯ä»˜æ–¹å¼**:
- å¾®ä¿¡æ”¯ä»˜ï¼ˆJSAPI / H5ï¼‰
- æ”¯ä»˜å®ï¼ˆæ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼‰
- Apple Payï¼ˆiOS PWAï¼‰

**è®¢å•ç®¡ç†**:
```typescript
interface Order {
  id: string;
  userId: string;
  productId: 'monthly' | 'yearly' | 'lifetime';
  amount: number;
  currency: 'CNY';
  status: 'pending' | 'paid' | 'cancelled' | 'refunded';
  paymentMethod: string;
  paymentTime?: Date;
  expiryTime?: Date;  // æœˆå¡/å¹´å¡æœ‰æ•ˆæœŸ
  createdAt: Date;
}

interface Subscription {
  userId: string;
  type: 'monthly' | 'yearly' | 'lifetime';
  startTime: Date;
  expiryTime: Date;
  autoRenew: boolean;  // æ˜¯å¦è‡ªåŠ¨ç»­è´¹
  status: 'active' | 'expired' | 'cancelled';
}
```

**ä¸ªäººä¸­å¿ƒ - ä¼šå‘˜ç®¡ç†**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆ‘çš„ä¼šå‘˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     ğŸŒŸ å¹´å¡ä¼šå‘˜ ğŸŒŸ          â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚  æœ‰æ•ˆæœŸè‡³ï¼š2027-02-11       â”‚   â”‚
â”‚  â”‚  å‰©ä½™ 365 å¤©                â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚  [å…³é—­è‡ªåŠ¨ç»­è´¹]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ ä¼šå‘˜æƒç›Š â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  å·²è§£é” 12/12 é¡¹ç‰¹æƒ                â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ è´­ä¹°è®°å½• â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  2026-02-11  å¹´å¡ä¼šå‘˜  Â¥128  å·²æ”¯ä»˜ â”‚
â”‚  2026-01-11  æœˆå¡ä¼šå‘˜  Â¥18   å·²è¿‡æœŸ â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.1.3 æŠ€æœ¯éœ€æ±‚

#### TR-VIP-001: ä¼šå‘˜çŠ¶æ€æ ¡éªŒ

```typescript
// ä¼šå‘˜æ ¡éªŒ Hook
function useVipCheck() {
  const { user } = useUser();
  
  const checkVip = useCallback((feature: VipFeature): VipCheckResult => {
    if (!user) return { allowed: false, reason: 'not_logged_in' };
    
    const subscription = user.subscription;
    if (!subscription || subscription.status !== 'active') {
      return { allowed: false, reason: 'not_vip' };
    }
    
    if (subscription.expiryTime < new Date()) {
      return { allowed: false, reason: 'expired' };
    }
    
    // æ£€æŸ¥åŠŸèƒ½æƒé™
    const featureLimit = VIP_FEATURES[feature];
    if (featureLimit.limit && user.usage[feature] >= featureLimit.limit) {
      return { allowed: false, reason: 'limit_reached' };
    }
    
    return { allowed: true };
  }, [user]);
  
  return { checkVip };
}

// åç«¯æƒé™ä¸­é—´ä»¶
class VipMiddleware:
    @staticmethod
    def check_vip_access(user_id: str, feature: str) -> bool:
        subscription = get_user_subscription(user_id)
        if not subscription or subscription.status != 'active':
            return False
        
        # æ£€æŸ¥åŠŸèƒ½æ˜¯å¦åœ¨è®¢é˜…èŒƒå›´å†…
        if feature not in SUBSCRIPTION_FEATURES[subscription.type]:
            return False
        
        return True
```

#### TR-VIP-002: æ”¯ä»˜é›†æˆ

```python
# å¾®ä¿¡æ”¯ä»˜ç»Ÿä¸€ä¸‹å•
class PaymentService:
    @staticmethod
    def create_wechat_order(user_id: str, product_id: str) -> dict:
        product = PRODUCTS[product_id]
        order_id = generate_order_id()
        
        # è°ƒç”¨å¾®ä¿¡æ”¯ä»˜ API
        params = {
            'appid': WECHAT_APPID,
            'mch_id': WECHAT_MCHID,
            'nonce_str': generate_nonce(),
            'body': f'å‘½è¿æ—¥å† - {product.name}',
            'out_trade_no': order_id,
            'total_fee': int(product.price * 100),  # å•ä½ä¸ºåˆ†
            'spbill_create_ip': get_client_ip(),
            'notify_url': f'{BASE_URL}/api/payment/wechat/notify',
            'trade_type': 'JSAPI' if is_wechat() else 'MWEB',
            'openid': get_user_openid(user_id) if is_wechat() else None
        }
        
        # ç”Ÿæˆç­¾åã€è°ƒç”¨ API
        # ...
        
        return {
            'orderId': order_id,
            'paymentParams': payment_params  # å‰ç«¯è°ƒèµ·æ”¯ä»˜æ‰€éœ€å‚æ•°
        }
    
    @staticmethod
    def handle_payment_notify(notify_data: dict) -> str:
        """å¤„ç†æ”¯ä»˜å›è°ƒ"""
        # éªŒç­¾
        # æ›´æ–°è®¢å•çŠ¶æ€
        # å¼€é€šä¼šå‘˜
        # å‘é€é€šçŸ¥
        return '<xml><return_code>SUCCESS</return_code></xml>'
```

### 2.1.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `vip_entry` | `{source: string}` | è¿›å…¥ä¼šå‘˜é¡µé¢ |
| `vip_plan_select` | `{plan: string, price: number}` | é€‰æ‹©å¥—é¤ |
| `vip_pay_click` | `{plan: string}` | ç‚¹å‡»æ”¯ä»˜ |
| `vip_pay_success` | `{plan: string, amount: number, order_id: string}` | æ”¯ä»˜æˆåŠŸ |
| `vip_pay_fail` | `{plan: string, error: string}` | æ”¯ä»˜å¤±è´¥ |
| `vip_feature_limit` | `{feature: string}` | è§¦å‘åŠŸèƒ½é™åˆ¶ |
| `vip_convert_show` | `{feature: string}` | å±•ç¤ºä¼šå‘˜å¼•å¯¼ |
| `vip_convert_click` | `{feature: string}` | ç‚¹å‡»ä¼šå‘˜å¼•å¯¼ |

---

## 2.2 åˆç›˜ç­‰ä¼ æ’­åŠŸèƒ½

### 2.2.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- ç°æœ‰åˆ†äº«æœºåˆ¶å•ä¸€ï¼Œç¼ºä¹ç—…æ¯’ä¼ æ’­å±æ€§
- ç”¨æˆ·ç¼ºä¹ä¸»åŠ¨åˆ†äº«çš„åŠ¨åŠ›
- æ–°ç”¨æˆ·è·å–æˆæœ¬é«˜

**ç›®æ ‡**:
- åˆç›˜åŠŸèƒ½ä½¿ç”¨ç‡ 20%
- é€šè¿‡åˆç›˜å¸¦æ¥çš„æ–°ç”¨æˆ·å æ¯” 25%
- åˆ†äº«ç‡æå‡è‡³ 15%

### 2.2.2 åŠŸèƒ½éœ€æ±‚

#### FR-MATCH-001: åŒäººåˆç›˜

**åŠŸèƒ½æè¿°**:  
ç”¨æˆ·è¾“å…¥ä¸¤ä¸ªäººçš„ç”Ÿè¾°å…«å­—ï¼Œç³»ç»Ÿåˆ†æä¸¤äººçš„ã€Œç¼˜åˆ†æŒ‡æ•°ã€ï¼ŒåŒ…æ‹¬çˆ±æƒ…ã€å‹æƒ…ã€äº‹ä¸šåˆä½œç­‰ç»´åº¦ã€‚

**åˆç›˜ç»´åº¦**:

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| å¤©å¹²åˆåŒ– | 25% | å¤©å¹²äº”åˆåˆ†æ |
| åœ°æ”¯å…³ç³» | 25% | ä¸‰åˆã€å…­åˆã€åˆ‘å†²å…‹å®³ |
| äº”è¡Œäº’è¡¥ | 20% | ç”¨ç¥äº’è¡¥ç¨‹åº¦ |
| ç”Ÿè‚–é…å¯¹ | 15% | ä¼ ç»Ÿç”Ÿè‚–åˆå©š |
| æ—¥ä¸»å…³ç³» | 15% | æ—¥å¹²ç›¸ç”Ÿç›¸å…‹ |

**ç»“æœå±•ç¤º**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼˜åˆ†åˆç›˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚      ğŸ‘¤ å°æ˜         ğŸ‘¤ å°çº¢        â”‚
â”‚     1990-05-20     1992-08-15     â”‚
â”‚       åˆæ—¶           è¾°æ—¶           â”‚
â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚   88åˆ†    â”‚              â”‚
â”‚         â”‚  å¤©ä½œä¹‹åˆ  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ ç»´åº¦åˆ†æ â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  çˆ±æƒ…å¥‘åˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  92åˆ†     â”‚
â”‚  å‹æƒ…æŒ‡æ•°  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  85åˆ†     â”‚
â”‚  äº‹ä¸šåˆä½œ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  78åˆ†     â”‚
â”‚  æ€§æ ¼äº’è¡¥  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  88åˆ†     â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ è¯¦ç»†è§£è¯» â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  ä½ ä»¬çš„å…«å­—å¤©å¹²ç›¸åˆï¼Œåœ°æ”¯ç›¸ç”Ÿï¼Œ      â”‚
â”‚  å±äºä¸Šç­‰å©šé…ã€‚æ€§æ ¼ä¸Šäº’è¡¥æ€§å¼ºï¼Œ      â”‚
â”‚  èƒ½å¤Ÿäº’ç›¸åŒ…å®¹ç†è§£...                 â”‚
â”‚                                     â”‚
â”‚  [ä¿å­˜ç»“æœ]  [åˆ†äº«ç»™ä»–/å¥¹]          â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆç›˜ç±»å‹**:
1. **æƒ…ä¾£åˆç›˜** - ä¾§é‡çˆ±æƒ…ã€å©šå§»
2. **å¥½å‹åˆç›˜** - ä¾§é‡å‹æƒ…ã€é»˜å¥‘
3. **äº‹ä¸šåˆç›˜** - ä¾§é‡åˆä½œã€è´¢è¿
4. **äº²å­åˆç›˜** - ä¾§é‡äº²å­å…³ç³»ã€æ•™è‚²

#### FR-MATCH-002: åˆç›˜åˆ†äº«ä¸å›æµ

**åˆ†äº«æœºåˆ¶**:
```
ç”¨æˆ·Aç”Ÿæˆåˆç›˜ â†’ åˆ†äº«ç»™ç”¨æˆ·B
    â”‚
    â”œâ”€â”€ åˆ†äº«å¡ç‰‡åŒ…å«ä¸¤äººåˆç›˜åˆ†æ•°å’Œç®€è¦è§£è¯»
    â”‚
    â””â”€â”€ ç”¨æˆ·Bç‚¹å‡»é“¾æ¥
            â”‚
            â”œâ”€â”€ æŸ¥çœ‹åˆç›˜ç»“æœï¼ˆéƒ¨åˆ†å±•ç¤ºï¼‰
            â”œâ”€â”€ æ˜¾ç¤ºã€Œæˆ‘ä¹Ÿæƒ³æµ‹æµ‹æˆ‘ä»¬çš„ç¼˜åˆ†ã€æŒ‰é’®
            â””â”€â”€ å¼•å¯¼ç”¨æˆ·Bè¾“å…¥è‡ªå·±çš„ä¿¡æ¯å®Œæˆåˆç›˜
```

**åˆ†äº«æ–‡æ¡ˆæ¨¡æ¿**:
```
ã€Œæˆ‘å’Œ {{partner_name}} çš„ç¼˜åˆ†æŒ‡æ•°æ˜¯ {{score}} åˆ†ï¼
{{comment}}

æµ‹æµ‹ä½ ä»¬çš„ç¼˜åˆ† â†’ [é“¾æ¥]ã€
```

#### FR-MATCH-003: è¿åŠ¿ PK

**åŠŸèƒ½æè¿°**:  
ç”¨æˆ·å¯ä»¥ä¸å¥½å‹æ¯”æ‹¼ä»Šæ—¥è¿åŠ¿åˆ†æ•°ï¼Œç”Ÿæˆæ’è¡Œæ¦œã€‚

**ç©æ³•**:
1. ç”¨æˆ·æŸ¥çœ‹ä»Šæ—¥è¿åŠ¿åï¼Œç‚¹å‡»ã€Œè¿åŠ¿ PKã€
2. é€‰æ‹© PK æ–¹å¼ï¼š
   - é‚€è¯·å¥½å‹ PKï¼ˆåˆ†äº«é“¾æ¥ï¼‰
   - éšæœºåŒ¹é… PK
   - æŸ¥çœ‹å¥½å‹æ’è¡Œæ¦œ
3. PK ç»“æœå±•ç¤ºï¼š
   - åŒæ–¹å…­ç»´å¯¹æ¯”
   - æ€»åˆ†èƒœè´Ÿ
   - è¶£å‘³è¯„è¯­

**PK ç»“æœç¤ºä¾‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿åŠ¿ PK ç»“æœ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚    ğŸ‘‘ å°æ˜  465åˆ†                   â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚         èƒœ                          â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚    å°çº¢  428åˆ†                      â”‚
â”‚                                     â”‚
â”‚  å°æ˜æ—¥è¿æ—ºç››ï¼Œå…¨æ–¹ä½ç¢¾å‹ï¼          â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ è¯¦ç»†å¯¹æ¯” â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  äº‹ä¸šè¿  å°æ˜ 85  vs  å°çº¢ 72       â”‚
â”‚  è´¢è¿    å°æ˜ 78  vs  å°çº¢ 80       â”‚
â”‚  æ¡ƒèŠ±è¿  å°æ˜ 92  vs  å°çº¢ 88       â”‚
â”‚  ...                                â”‚
â”‚                                     â”‚
â”‚  [å†æ¥ä¸€å±€]  [åˆ†äº«æˆ˜ç»©]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2.3 æŠ€æœ¯éœ€æ±‚

#### TR-MATCH-001: åˆç›˜ç®—æ³•

```python
class MatchService:
    @staticmethod
    def calculate_compatibility(person_a: BaZi, person_b: BaZi, match_type: str) -> MatchResult:
        """
        è®¡ç®—ä¸¤äººå…«å­—åˆç›˜
        """
        scores = {}
        
        # 1. å¤©å¹²åˆåŒ– (25%)
        gan_score = analyze_gan_he(person_a.day_gan, person_b.day_gan)
        scores['gan'] = gan_score * 0.25
        
        # 2. åœ°æ”¯å…³ç³» (25%)
        zhi_score = analyze_zhi_relation(person_a.zhi_list, person_b.zhi_list)
        scores['zhi'] = zhi_score * 0.25
        
        # 3. äº”è¡Œäº’è¡¥ (20%)
        wuxing_score = analyze_wuxing_complement(
            person_a.wuxing_distribution,
            person_b.wuxing_distribution
        )
        scores['wuxing'] = wuxing_score * 0.20
        
        # 4. ç”Ÿè‚–é…å¯¹ (15%)
        animal_score = SHENG_XIAO_SCORE[
            (person_a.animal, person_b.animal)
        ]
        scores['animal'] = animal_score * 0.15
        
        # 5. æ—¥ä¸»å…³ç³» (15%)
        rizhu_score = analyze_rizhu_relation(person_a.rizhu, person_b.rizhu)
        scores['rizhu'] = rizhu_score * 0.15
        
        total_score = sum(scores.values())
        
        return MatchResult(
            total_score=total_score,
            dimension_scores=scores,
            comment=generate_comment(total_score, match_type),
            details=generate_details(person_a, person_b, scores)
        )
```

#### TR-MATCH-002: åˆ†äº«å¡ç‰‡ç”Ÿæˆ

```typescript
// åˆç›˜åˆ†äº«å¡ç‰‡
interface MatchShareCard {
  personA: { name: string; avatar?: string };
  personB: { name: string; avatar?: string };
  score: number;
  comment: string;
  matchType: 'love' | 'friend' | 'career' | 'family';
  qrCode: string; // å°ç¨‹åº/ç½‘é¡µäºŒç»´ç 
}

async function generateMatchCard(data: MatchShareCard): Promise<Blob> {
  // ä½¿ç”¨ html-to-image ç”Ÿæˆåˆ†äº«å¡ç‰‡
  // æ¨¡æ¿æ ¹æ® matchType é€‰æ‹©ä¸åŒé£æ ¼
}
```

### 2.2.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `match_enter` | `{type: string}` | è¿›å…¥åˆç›˜åŠŸèƒ½ |
| `match_calculate` | `{type: string, duration: number}` | è®¡ç®—åˆç›˜ |
| `match_share` | `{type: string, channel: string}` | åˆ†äº«åˆç›˜ |
| `match_share_entry` | `{source_user_id: string}` | é€šè¿‡åˆ†äº«è¿›å…¥ |
| `match_complete` | `{type: string}` | å®ŒæˆåŒæ–¹åˆç›˜ |
| `pk_enter` | - | è¿›å…¥è¿åŠ¿ PK |
| `pk_invite` | `{channel: string}` | é‚€è¯·å¥½å‹ PK |
| `pk_result` | `{result: 'win' \| 'lose' \| 'draw'}` | PK ç»“æœ |

---

# Phase 3: å†…å®¹ç”Ÿæ€ (M3-M4)

## 3.1 çŸ¥è¯†åº“å»ºè®¾

### 3.1.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- ç”¨æˆ·å¯¹å…«å­—å‘½ç†çŸ¥è¯†æœ‰å­¦ä¹ éœ€æ±‚ï¼Œä½†ç¼ºä¹ç³»ç»ŸåŒ–å†…å®¹
- SEO æµé‡è·å–ä¸è¶³ï¼Œè‡ªç„¶æµé‡å æ¯”ä½
- ç”¨æˆ·åœç•™æ—¶é—´çŸ­ï¼Œå¹³å‡ä»… 2-3 åˆ†é’Ÿ

**ç›®æ ‡**:
- çŸ¥è¯†åº“æ–‡ç« è¦†ç›– 100+ å…³é”®è¯
- è‡ªç„¶æœç´¢æµé‡å æ¯”æå‡è‡³ 30%
- ç”¨æˆ·å¹³å‡åœç•™æ—¶é—´æå‡è‡³ 6 åˆ†é’Ÿ

### 3.1.2 åŠŸèƒ½éœ€æ±‚

#### FR-KB-001: å‘½ç†çŸ¥è¯†åº“

**å†…å®¹åˆ†ç±»**:

| åˆ†ç±» | å†…å®¹æ–¹å‘ | ç¤ºä¾‹æ–‡ç«  |
|------|----------|----------|
| å…«å­—å…¥é—¨ | åŸºç¡€çŸ¥è¯† | ã€Œä»€ä¹ˆæ˜¯å…«å­—ï¼Ÿä¸‰åˆ†é’Ÿå…¥é—¨ã€ |
| åç¥è¯¦è§£ | åç¥è§£è¯» | ã€Œæ­£å®˜æ ¼çš„äººé€‚åˆä»€ä¹ˆèŒä¸šï¼Ÿã€ |
| äº”è¡Œåˆ†æ | äº”è¡ŒçŸ¥è¯† | ã€Œäº”è¡Œç¼ºæœ¨å¦‚ä½•è¡¥æ•‘ï¼Ÿã€ |
| æµå¹´è¿åŠ¿ | å¹´åº¦è¿åŠ¿ | ã€Œ2025å¹´å±è›‡äººçš„è¿åŠ¿è¯¦è§£ã€ |
| ç”Ÿè‚–è¿åŠ¿ | ç”Ÿè‚–åˆ†æ | ã€Œ2025å¹´12ç”Ÿè‚–è¿åŠ¿æ’è¡Œæ¦œã€ |
| åˆå©šé…å¯¹ | å©šæ‹æŒ‡å¯¼ | ã€Œå…«å­—åˆå©šï¼šå¦‚ä½•æ‰¾åˆ°å¯¹çš„äººï¼Ÿã€ |
| èµ·åæ”¹å | å‘½åå­¦ | ã€Œå¦‚ä½•æ ¹æ®å…«å­—èµ·å¥½åå­—ï¼Ÿã€ |
| é£æ°´å¸ƒå±€ | é£æ°´çŸ¥è¯† | ã€Œ2025å¹´å®¶å±…é£æ°´å¸ƒå±€æŒ‡å—ã€ |

**å†…å®¹å½¢å¼**:

| å½¢å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| æ–‡ç«  | 1000-3000å­—æ·±åº¦å†…å®¹ | æ ¸å¿ƒçŸ¥è¯†è®²è§£ |
| å›¾è§£ | ä¿¡æ¯å›¾è¡¨ã€æµç¨‹å›¾ | æ¦‚å¿µè§£é‡Š |
| è§†é¢‘ | 3-5åˆ†é’ŸçŸ­è§†é¢‘ | å¤æ‚æ¦‚å¿µæ¼”ç¤º |
| å·¥å…· | äº’åŠ¨è®¡ç®—å™¨ | å®ç”¨å·¥å…·ï¼ˆå¦‚å…«å­—æ’ç›˜ï¼‰ |

**æ–‡ç« é¡µé¢è®¾è®¡**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŸ¥è¯†åº“                  [æœç´¢]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [å…«å­—å…¥é—¨] [åç¥è¯¦è§£] [æµå¹´è¿åŠ¿]   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚      [æ–‡ç« å°é¢å›¾]           â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  2025å¹´å±è›‡äººçš„è¿åŠ¿è¯¦è§£             â”‚
â”‚  é˜…è¯» 12.5k Â· æ”¶è— 892 Â· 2025-01-15 â”‚
â”‚                                     â”‚
â”‚  2025å¹´æ˜¯ä¹™å·³å¹´ï¼Œå±è›‡äººè¿æ¥æœ¬å‘½å¹´...â”‚
â”‚                                     â”‚
â”‚  [ç»§ç»­é˜…è¯»]                         â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ ç›¸å…³æ–‡ç«  â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”  2025å¹´12ç”Ÿè‚–è¿åŠ¿æ’è¡Œ      â”‚
â”‚  â”‚å›¾  â”‚  é˜…è¯» 23.1k                 â”‚
â”‚  â””â”€â”€â”€â”€â”˜                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”  æœ¬å‘½å¹´æ³¨æ„äº‹é¡¹             â”‚
â”‚  â”‚å›¾  â”‚  é˜…è¯» 8.7k                  â”‚
â”‚  â””â”€â”€â”€â”€â”˜                             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-KB-002: ä¸ªæ€§åŒ–å†…å®¹æ¨è

**æ¨èç­–ç•¥**:

```python
def recommend_articles(user: User, context: Context) -> List[Article]:
    """
    åŸºäºç”¨æˆ·ç”»åƒæ¨èæ–‡ç« 
    """
    recommendations = []
    
    # 1. åŸºäºå…«å­—æ¨è
    if user.bazi:
        # æ¨èä¸ç”¨æˆ·ç”¨ç¥ç›¸å…³çš„æ–‡ç« 
        recommendations.extend(
            get_articles_by_wuxing(user.bazi.yong_shen)
        )
        
        # æ¨èä¸ç”¨æˆ·ç”Ÿè‚–ç›¸å…³çš„æµå¹´è¿åŠ¿
        recommendations.extend(
            get_liunian_articles(user.bazi.animal, current_year())
        )
    
    # 2. åŸºäºæµè§ˆå†å²æ¨è
    if user.view_history:
        similar_articles = find_similar_articles(user.view_history)
        recommendations.extend(similar_articles)
    
    # 3. çƒ­é—¨å†…å®¹
    recommendations.extend(get_trending_articles(limit=5))
    
    # å»é‡ã€æ’åº
    return deduplicate_and_rank(recommendations)
```

#### FR-KB-003: å†…å®¹ç”Ÿæˆè‡ªåŠ¨åŒ–

**è‡ªåŠ¨åŒ–æµç¨‹**:

```
æ•°æ®è¾“å…¥ï¼ˆèŠ‚æ°”ã€å¹´ä»½ã€ç”Ÿè‚–ï¼‰
    â”‚
    â”œâ”€â”€ AI ç”Ÿæˆæ–‡ç« åˆç¨¿ï¼ˆDeepSeek APIï¼‰
    â”‚
    â”œâ”€â”€ äººå·¥å®¡æ ¸ä¸æ¶¦è‰²
    â”‚
    â”œâ”€â”€ SEO ä¼˜åŒ–ï¼ˆæ ‡é¢˜ã€å…³é”®è¯ã€æè¿°ï¼‰
    â”‚
    â”œâ”€â”€ é…å›¾ç”Ÿæˆï¼ˆAI ç»˜å›¾ï¼‰
    â”‚
    â””â”€â”€ å‘å¸ƒä¸Šçº¿
```

**è‡ªåŠ¨åŒ–å†…å®¹ç±»å‹**:
- æ¯æ—¥è¿åŠ¿æ–‡ç« ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- å¹´åº¦ç”Ÿè‚–è¿åŠ¿ï¼ˆæ¯å¹´åº•æ‰¹é‡ç”Ÿæˆï¼‰
- èŠ‚æ°”è¿åŠ¿æé†’ï¼ˆè‡ªåŠ¨è§¦å‘ï¼‰

### 3.1.3 æŠ€æœ¯éœ€æ±‚

#### TR-KB-001: CMS å†…å®¹ç®¡ç†

```typescript
// å†…å®¹æ¨¡å‹
interface Article {
  id: string;
  title: string;
  slug: string;  // URL å‹å¥½çš„æ ‡è¯†
  summary: string;
  content: string;  // Markdown / Rich Text
  coverImage: string;
  category: string;
  tags: string[];
  
  // SEO
  metaTitle: string;
  metaDescription: string;
  keywords: string[];
  
  // ç»Ÿè®¡
  viewCount: number;
  likeCount: number;
  shareCount: number;
  
  // çŠ¶æ€
  status: 'draft' | 'published' | 'archived';
  publishTime?: Date;
  createTime: Date;
  updateTime: Date;
}

// API
GET /api/kb/articles          # æ–‡ç« åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰
GET /api/kb/articles/:slug    # æ–‡ç« è¯¦æƒ…
GET /api/kb/categories        # åˆ†ç±»åˆ—è¡¨
GET /api/kb/recommendations   # ä¸ªæ€§åŒ–æ¨è
```

#### TR-KB-002: SEO ä¼˜åŒ–

```html
<!-- æ–‡ç« é¡µé¢ SEO -->
<head>
  <title>2025å¹´å±è›‡äººçš„è¿åŠ¿è¯¦è§£ | å‘½è¿æ—¥å†</title>
  <meta name="description" content="2025å¹´ä¹™å·³å¹´ï¼Œå±è›‡äººæœ¬å‘½å¹´è¿åŠ¿å…¨è§£æã€‚äº‹ä¸šã€è´¢è¿ã€æ„Ÿæƒ…ã€å¥åº·å…¨æ–¹ä½è§£è¯»ï¼ŒåŠ©æ‚¨è¶‹å‰é¿å‡¶ã€‚">
  <meta name="keywords" content="2025å¹´è¿åŠ¿,å±è›‡äºº,æœ¬å‘½å¹´,å…«å­—è¿åŠ¿">
  
  <!-- Open Graph -->
  <meta property="og:title" content="2025å¹´å±è›‡äººçš„è¿åŠ¿è¯¦è§£">
  <meta property="og:description" content="2025å¹´ä¹™å·³å¹´ï¼Œå±è›‡äººæœ¬å‘½å¹´è¿åŠ¿å…¨è§£æ...">
  <meta property="og:image" content="https://example.com/images/2025-snake.jpg">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "2025å¹´å±è›‡äººçš„è¿åŠ¿è¯¦è§£",
    "author": {
      "@type": "Organization",
      "name": "å‘½è¿æ—¥å†"
    },
    "datePublished": "2025-01-15",
    "image": "https://example.com/images/2025-snake.jpg"
  }
  </script>
</head>
```

### 3.1.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `kb_enter` | - | è¿›å…¥çŸ¥è¯†åº“ |
| `kb_category_view` | `{category: string}` | æŸ¥çœ‹åˆ†ç±» |
| `kb_article_view` | `{article_id: string, source: string}` | é˜…è¯»æ–‡ç«  |
| `kb_article_scroll` | `{article_id: string, percentage: number}` | æ–‡ç« æ»šåŠ¨æ·±åº¦ |
| `kb_article_like` | `{article_id: string}` | ç‚¹èµæ–‡ç«  |
| `kb_article_share` | `{article_id: string, channel: string}` | åˆ†äº«æ–‡ç«  |
| `kb_article_collect` | `{article_id: string}` | æ”¶è—æ–‡ç«  |

---

## 3.2 AI å’¨è¯¢å‡çº§

### 3.2.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- å½“å‰ AI å’¨è¯¢ä¸ºç®€å•çš„é—®ç­”å½¢å¼ï¼Œç¼ºä¹è¿ç»­æ€§å’Œè®°å¿†
- ç”¨æˆ·æ„Ÿå—ä¸åˆ°ã€Œä¸“å±å‘½ç†å¸ˆã€çš„ä½“éªŒ
- AI å›å¤è´¨é‡ä¸ç¨³å®š

**ç›®æ ‡**:
- AI å’¨è¯¢æ»¡æ„åº¦ 4.5+/5
- äººå‡å’¨è¯¢æ¬¡æ•°æå‡è‡³ 5 æ¬¡/å‘¨
- AI å’¨è¯¢å¸¦æ¥çš„ä¼šå‘˜è½¬åŒ–ç‡ 10%

### 3.2.2 åŠŸèƒ½éœ€æ±‚

#### FR-AI-001: AI å‘½ç†å¸ˆäººè®¾

**äººè®¾è®¾è®¡**:

| å±æ€§ | è®¾å®š |
|------|------|
| åå­— | ã€Œäº‘æ –å­ã€ |
| æ€§åˆ« | ä¸­æ€§ï¼Œåå‘æ¸©å’Œé•¿è€… |
| æ€§æ ¼ | æ™ºæ…§ã€æ¸©å’Œã€è€å¿ƒã€ä¸“ä¸š |
| è¯´è¯é£æ ¼ | å¤å…¸ä¸ç°ä»£ç»“åˆï¼Œå¶å°”å¼•ç”¨å¤ç±ä½†ä¸æ™¦æ¶© |
| ç‰¹é•¿ | å…«å­—å‘½ç†ã€è¿åŠ¿åˆ†æã€å¿ƒç†ç–å¯¼ |

**äººè®¾ç¤ºä¾‹å¯¹è¯**:

```
ç”¨æˆ·ï¼šæˆ‘æœ€è¿‘å·¥ä½œä¸é¡ºï¼Œæ€ä¹ˆåŠï¼Ÿ

äº‘æ –å­ï¼šé“å‹è«æ€¥ï¼Œè®©æˆ‘å…ˆè§‚ä¸€è§‚æ‚¨çš„å‘½ç›˜ã€‚
ï¼ˆæŸ¥çœ‹å…«å­—ï¼‰

æ‚¨æ—¥ä¸»ä¸ºç”²æœ¨ï¼Œä»Šå¹´æµå¹´åºšé‡‘å…‹èº«ï¼Œäº‹ä¸šä¸Šç¡®å®å®¹æ˜“é‡åˆ°é˜»ç¢ã€‚

ä¸è¿‡ï¼Œæ‚¨çš„ç”¨ç¥ä¸ºæ°´ï¼Œæœ¬æœˆæ°é€¢æ°´æ—ºä¹‹æ—¶ï¼Œæ­£æ˜¯ç ´å±€ä¹‹æœºã€‚

å»ºè®®æ‚¨ï¼š
1. å¤šä¸å±é¼ ã€å±çŒªçš„æœ‹å‹äº¤æµï¼Œä»–ä»¬å±æ°´ï¼Œèƒ½åŠ©æ‚¨è¿åŠ¿
2. åŠå…¬å®¤å¯æ‘†æ”¾ä¸€æ¯æ¸…æ°´ï¼Œæ¯æ—¥æ›´æ¢
3. æœ¬æœˆ15æ—¥å‰åï¼Œæœ‰ä¸€æ¬¡è½¬è¿æœºä¼šï¼Œå¯ä¸»åŠ¨äº‰å–

è®°ä½ï¼Œå‘½ç†åªæ˜¯å‚è€ƒï¼Œäº‹åœ¨äººä¸ºã€‚æ‚¨å…«å­—ä¸­æ­£å®˜é€å‡ºï¼Œåªè¦ç¨³æ‰ç¨³æ‰“ï¼Œå¿…èƒ½æ¸¡è¿‡éš¾å…³ã€‚

è¿˜æœ‰å…¶ä»–æƒ³èŠçš„å—ï¼ŸğŸ˜Š
```

#### FR-AI-002: è®°å¿†ä¸è¿ç»­å¯¹è¯

**è®°å¿†ç»´åº¦**:

| ç±»å‹ | å†…å®¹ | ç”¨é€” |
|------|------|------|
| é•¿æœŸè®°å¿† | ç”¨æˆ·å…«å­—ã€ç”¨ç¥ã€å–œå¿Œ | åŸºç¡€åˆ†æä¾æ® |
| ä¸­æœŸè®°å¿† | è¿‘æœŸå’¨è¯¢è¯é¢˜ã€å…³æ³¨ç‚¹ | å»¶ç»­å¯¹è¯ä¸Šä¸‹æ–‡ |
| çŸ­æœŸè®°å¿† | å½“å‰å¯¹è¯ä¸»é¢˜ | å³æ—¶å›å¤å‚è€ƒ |
| æƒ…æ„Ÿè®°å¿† | ç”¨æˆ·æƒ…ç»ªçŠ¶æ€ã€é‡è¦äº‹ä»¶ | æä¾›æƒ…æ„Ÿæ”¯æŒ |

**æŠ€æœ¯å®ç°**:

```typescript
interface AIMemory {
  userId: string;
  
  // é•¿æœŸè®°å¿†ï¼ˆç”¨æˆ·æ¡£æ¡ˆï¼‰
  profile: {
    bazi: BaZi;
    yongShen: string;
    personality: string[];
  };
  
  // ä¸­æœŸè®°å¿†ï¼ˆæœ€è¿‘10è½®å¯¹è¯æ‘˜è¦ï¼‰
  recentTopics: Array<{
    topic: string;
    summary: string;
    timestamp: Date;
  }>;
  
  // é‡è¦äº‹ä»¶ï¼ˆç”¨æˆ·ä¸»åŠ¨å‘ŠçŸ¥ï¼‰
  importantEvents: Array<{
    type: 'job_change' | 'relationship' | 'health' | 'other';
    description: string;
    date: Date;
  }>;
}

// å¯¹è¯æ—¶æ³¨å…¥è®°å¿†
function buildPromptWithMemory(userMessage: string, memory: AIMemory): string {
  const context = `
ä½ æ˜¯äº‘æ –å­ï¼Œä¸€ä½ç²¾é€šå…«å­—å‘½ç†çš„AIå‘½ç†å¸ˆã€‚

ç”¨æˆ·æ¡£æ¡ˆï¼š
- å…«å­—ï¼š${memory.profile.bazi}
- ç”¨ç¥ï¼š${memory.profile.yongShen}
- æ€§æ ¼ç‰¹ç‚¹ï¼š${memory.profile.personality.join('ã€')}

è¿‘æœŸå…³æ³¨ï¼š
${memory.recentTopics.slice(-3).map(t => `- ${t.topic}: ${t.summary}`).join('\n')}

é‡è¦äº‹ä»¶ï¼š
${memory.importantEvents.map(e => `- ${e.date}: ${e.description}`).join('\n')}

è¯·ä»¥äº‘æ –å­çš„å£å»å›å¤ç”¨æˆ·çš„é—®é¢˜ã€‚
  `;
  
  return `${context}\n\nç”¨æˆ·ï¼š${userMessage}\n\näº‘æ –å­ï¼š`;
}
```

#### FR-AI-003: ä¸»åŠ¨å…³æ€€

**è§¦å‘åœºæ™¯**:

| åœºæ™¯ | è§¦å‘æ¡ä»¶ | ä¸»åŠ¨æ¶ˆæ¯ |
|------|----------|----------|
| ç”Ÿæ—¥å…³æ€€ | ç”¨æˆ·ç”Ÿæ—¥å½“å¤© | ã€Œä»Šæ—¥æ˜¯æ‚¨çš„ç”Ÿè¾°ï¼Œç¥æ‚¨ç”Ÿæ—¥å¿«ä¹ï¼è®©æˆ‘ä¸ºæ‚¨çœ‹çœ‹ä»Šå¹´çš„è¿åŠ¿...ã€ |
| è¿åŠ¿çªå˜ | æ£€æµ‹åˆ°è¿åŠ¿éª¤é™ | ã€Œæ˜æ—¥æ‚¨çš„è´¢è¿æœ‰æ‰€æ³¢åŠ¨ï¼Œå»ºè®®...ã€ |
| èŠ‚æ°”æé†’ | èŠ‚æ°”å½“å¤© | ã€Œç«‹æ˜¥åˆ°ï¼æ–°çš„è¿åŠ¿å‘¨æœŸå¼€å¯ï¼Œé€‚åˆ...ã€ |
| æ²‰é»˜å”¤é†’ | 7å¤©æœªå’¨è¯¢ | ã€Œå¥½ä¹…ä¸è§ï¼æœ€è¿‘å¯å¥½ï¼Ÿæœ‰ä»€ä¹ˆæƒ³èŠçš„å—ï¼Ÿã€ |
| äº‹ä»¶è·Ÿè¿› | ç”¨æˆ·æåŠçš„é‡è¦æ—¥æœŸå | ã€Œä¸Šæ¬¡æ‚¨è¯´çš„é¢è¯•ï¼Œç»“æœå¦‚ä½•ï¼Ÿéœ€è¦æˆ‘å†å¸®æ‚¨çœ‹çœ‹å—ï¼Ÿã€ |

**å…³æ€€æ¶ˆæ¯å½¢å¼**:
- æ¨é€é€šçŸ¥ + å¿«æ·å›å¤
- èŠå¤©ç•Œé¢ä¸»åŠ¨æ°”æ³¡

#### FR-AI-004: å’¨è¯¢è´¨é‡æå‡

**ä¼˜åŒ–ç­–ç•¥**:

1. **RAG çŸ¥è¯†å¢å¼º**
   ```
   ç”¨æˆ·æé—® â†’ æ£€ç´¢çŸ¥è¯†åº“ â†’ ç»“åˆå…«å­— â†’ AIç”Ÿæˆå›å¤
   ```

2. **å¤šè½®ç¡®è®¤æœºåˆ¶**
   ```
   ç”¨æˆ·ï¼šæˆ‘é€‚åˆæ¢å·¥ä½œå—ï¼Ÿ
   AIï¼šæ¢å·¥ä½œæ˜¯å¤§äº‹ï¼Œè®©æˆ‘å…ˆçœ‹çœ‹æ‚¨çš„æƒ…å†µã€‚
       æ‚¨ç›®å‰çš„å·¥ä½œæ˜¯ä»€ä¹ˆæ–¹å‘ï¼Ÿï¼ˆäº’è”ç½‘/é‡‘è/æ•™è‚²...ï¼‰
   ç”¨æˆ·ï¼šäº’è”ç½‘
   AIï¼šäº†è§£äº†ã€‚ä»æ‚¨çš„å…«å­—çœ‹ï¼Œä»Šå¹´æµå¹´...
   ```

3. **äººå·¥å…œåº•**
   - å¤æ‚é—®é¢˜æ ‡è®°ï¼Œäººå·¥å‘½ç†å¸ˆå®šæœŸå›å¤
   - ç”¨æˆ·æ»¡æ„åº¦ä½æ—¶ä¸»åŠ¨æä¾›äººå·¥å’¨è¯¢å…¥å£

### 3.2.3 æŠ€æœ¯éœ€æ±‚

#### TR-AI-001: AI æœåŠ¡å‡çº§

```python
class AIService:
    def __init__(self):
        self.deepseek = DeepSeekClient(api_key=DEEPSEEK_API_KEY)
        self.memory_store = MemoryStore()
        self.knowledge_base = KnowledgeBase()
    
    async def chat(self, user_id: str, message: str) -> str:
        # 1. è·å–ç”¨æˆ·è®°å¿†
        memory = await self.memory_store.get(user_id)
        
        # 2. æ£€ç´¢ç›¸å…³çŸ¥è¯†
        relevant_knowledge = await self.knowledge_base.search(
            query=message,
            user_bazi=memory.profile.bazi
        )
        
        # 3. æ„å»ºæç¤ºè¯
        prompt = self.build_prompt(
            message=message,
            memory=memory,
            knowledge=relevant_knowledge
        )
        
        # 4. è°ƒç”¨ DeepSeek API
        response = await self.deepseek.chat(prompt)
        
        # 5. æ›´æ–°è®°å¿†
        await self.memory_store.update(user_id, {
            'last_topic': extract_topic(message, response),
            'timestamp': now()
        })
        
        return response
    
    def build_prompt(self, message: str, memory: AIMemory, knowledge: List[str]) -> str:
        return f"""
ä½ æ˜¯äº‘æ –å­ï¼Œä¸€ä½ç²¾é€šå…«å­—å‘½ç†çš„AIå‘½ç†å¸ˆã€‚è¯´è¯æ¸©å’Œã€æœ‰æ™ºæ…§ï¼Œå¶å°”å¼•ç”¨å¤ç±ä½†ä¸æ™¦æ¶©ã€‚

## ç”¨æˆ·æ¡£æ¡ˆ
- å…«å­—ï¼š{memory.profile.bazi}
- ç”¨ç¥ï¼š{memory.profile.yong_shen}
- æ€§æ ¼ï¼š{', '.join(memory.profile.personality)}

## ç”¨æˆ·è¿‘æœŸå…³æ³¨
{self.format_recent_topics(memory.recentTopics)}

## ç›¸å…³çŸ¥è¯†
{chr(10).join(knowledge)}

## å¯¹è¯å†å²
{self.format_chat_history(memory.recentChats)}

## ç”¨æˆ·é—®é¢˜
{message}

è¯·ä»¥äº‘æ –å­çš„å£å»å›å¤ï¼Œè¦ä½“ç°ä¸“ä¸šæ€§ã€äº²å’ŒåŠ›å’Œä¸ªæ€§ã€‚å¦‚æœæ¶‰åŠå…«å­—åˆ†æï¼Œè¯·ç»“åˆç”¨æˆ·çš„ç”¨ç¥å–œå¿Œã€‚

äº‘æ –å­ï¼š
"""
```

### 3.2.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `ai_chat_start` | - | å¼€å§‹ AI å’¨è¯¢ |
| `ai_message_send` | `{length: number}` | å‘é€æ¶ˆæ¯ |
| `ai_message_receive` | `{length: number, latency: number}` | æ¥æ”¶å›å¤ |
| `ai_feedback` | `{rating: number, comment?: string}` | æ»¡æ„åº¦è¯„ä»· |
| `ai_limit_reach` | - | è¾¾åˆ°å…è´¹æ¬¡æ•°é™åˆ¶ |
| `ai_proactive_message` | `{type: string}` | æ¥æ”¶ä¸»åŠ¨æ¶ˆæ¯ |

---

## 3.3 ç¤¾åŒºåŠŸèƒ½æµ‹è¯•

### 3.3.1 éœ€æ±‚èƒŒæ™¯

**é—®é¢˜å®šä¹‰**:
- ç”¨æˆ·ä¹‹é—´ç¼ºä¹äº’åŠ¨ï¼Œäº§å“å·¥å…·å±æ€§å¼ºï¼Œç¤¾åŒºå±æ€§å¼±
- ç”¨æˆ·ç•™å­˜ä¸»è¦ä¾èµ–è¿åŠ¿æŸ¥è¯¢ï¼Œç¼ºä¹ç¤¾äº¤ç²˜æ€§
- ä¼˜è´¨ UGC å†…å®¹ç¼ºä¹æ²‰æ·€æ¸ é“

**ç›®æ ‡**:
- ç¤¾åŒºåŠŸèƒ½ä½¿ç”¨ç‡ 15%
- ç¤¾åŒºç”¨æˆ· 7 æ—¥ç•™å­˜ç‡ 50%
- UGC å†…å®¹æ—¥å‡äº§å‡º 100+

### 3.3.2 åŠŸèƒ½éœ€æ±‚

#### FR-COMM-001: è¿åŠ¿åœˆå­

**åœˆå­åˆ†ç±»**:

| åœˆå­ | ä¸»é¢˜ | å†…å®¹å½¢å¼ |
|------|------|----------|
| åäºŒç”Ÿè‚–åœˆ | æŒ‰ç”Ÿè‚–åˆ’åˆ† | è¿åŠ¿äº¤æµã€åæ§½ |
| å…«å­—å­¦å ‚ | å‘½ç†å­¦ä¹  | çŸ¥è¯†åˆ†äº«ã€ç­”ç–‘ |
| æ¡ƒèŠ±é©¿ç«™ | æ„Ÿæƒ…äº¤æµ | æƒ…æ„Ÿæ•…äº‹ã€åˆç›˜åˆ†äº« |
| èŒåœºè¿åŠ¿ | äº‹ä¸šå‘å±• | èŒåœºç»éªŒã€æ±‚èŒåˆ†äº« |
| æ¯æ—¥æ‰“å¡ | ä¹ æƒ¯å…»æˆ | è¿åŠ¿æ‰“å¡ã€è®¸æ„¿ |

**å¸–å­å½¢å¼**:

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| è¿åŠ¿åˆ†äº« | åˆ†äº«ä»Šæ—¥è¿åŠ¿ | ã€Œä»Šæ—¥è´¢è¿äº”æ˜Ÿï¼Œå±…ç„¶çœŸçš„æ”¶åˆ°äº†å¥–é‡‘ï¼ã€ |
| åˆç›˜æ™’å›¾ | åˆ†äº«åˆç›˜ç»“æœ | ã€Œå’Œç”·æœ‹å‹çš„åˆç›˜ï¼Œ88åˆ†ï¼æ±‚ç¥ç¦ï½ã€ |
| é—®é¢˜æ±‚åŠ© | å‘ç¤¾åŒºæ±‚åŠ© | ã€Œæœ€è¿‘å·¥ä½œä¸é¡ºï¼Œæœ‰å¤§ç¥å¸®çœ‹çœ‹å—ï¼Ÿã€ |
| çŸ¥è¯†åˆ†äº« | åˆ†äº«å‘½ç†çŸ¥è¯† | ã€Œåç¥è¯¦è§£ï¼šæ­£å®˜æ ¼çš„ç‰¹ç‚¹ã€ |
| æ‰“å¡ç­¾åˆ° | æ¯æ—¥æ‰“å¡ | ã€ŒDay 30 æ¯æ—¥è¿åŠ¿æ‰“å¡ã€ |

**å¸–å­ç•Œé¢**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿åŠ¿åœˆå­              [å‘å¸–]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [æ¨è] [åäºŒç”Ÿè‚–] [å…«å­—å­¦å ‚]        â”‚
â”‚  [æ¡ƒèŠ±é©¿ç«™] [èŒåœºè¿åŠ¿]               â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€ çƒ­é—¨å¸–å­ â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ å°æ˜  Â·  2å°æ—¶å‰         â”‚   â”‚
â”‚  â”‚ #æ¡ƒèŠ±é©¿ç«™                   â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ å’Œç”·æœ‹å‹çš„åˆç›˜ï¼Œ88åˆ†ï¼      â”‚   â”‚
â”‚  â”‚ [åˆç›˜æˆªå›¾]                  â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ è¯„è®º 23  ç‚¹èµ 156  åˆ†äº« 12  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ å°çº¢  Â·  5å°æ—¶å‰         â”‚   â”‚
â”‚  â”‚ #æ¯æ—¥æ‰“å¡                   â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ Day 30 æ¯æ—¥è¿åŠ¿æ‰“å¡         â”‚   â”‚
â”‚  â”‚ ä»Šæ—¥äº‹ä¸šè¿è¶…æ£’ï¼Œå®Œæˆäº†      â”‚   â”‚
â”‚  â”‚ ä¸€ä¸ªå¤§é¡¹ç›®ï¼                â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ è¯„è®º 8   ç‚¹èµ 45            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### FR-COMM-002: å‘½ç†é—®ç­”

**åŠŸèƒ½æè¿°**:  
ç”¨æˆ·å¯ä»¥å‘å¸ƒå‘½ç†ç›¸å…³é—®é¢˜ï¼Œå…¶ä»–ç”¨æˆ·æˆ–ã€Œäº‘æ –å­ã€AI å¯ä»¥å›ç­”ã€‚

**é—®ç­”æµç¨‹**:

```
æé—®è€…å‘å¸ƒé—®é¢˜
    â”‚
    â”œâ”€â”€ ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ AI å›ç­”ï¼ˆå¿«é€Ÿå“åº”ï¼‰
    â”‚
    â””â”€â”€ ç¤¾åŒºç”¨æˆ·å‚ä¸å›ç­”
            â”‚
            â”œâ”€â”€ æé—®è€…é€‰æ‹©æœ€ä½³ç­”æ¡ˆ
            â”œâ”€â”€ å…¶ä»–ç”¨æˆ·ç‚¹èµæœ‰ç”¨å›ç­”
            â””â”€â”€ ä¼˜è´¨å›ç­”è€…è·å¾—ç§¯åˆ†
```

**æ¿€åŠ±æœºåˆ¶**:

| è¡Œä¸º | ç§¯åˆ†å¥–åŠ± | è¯´æ˜ |
|------|----------|------|
| å›ç­”é—®é¢˜ | +5 åˆ† | åŸºç¡€å¥–åŠ± |
| å›ç­”è¢«é‡‡çº³ | +20 åˆ† | æœ€ä½³ç­”æ¡ˆ |
| å›ç­”è·èµ | +2 åˆ†/èµ | ä¼˜è´¨å†…å®¹ |
| æ¯æ—¥ç­¾åˆ° | +1 åˆ† | æ´»è·ƒæ¿€åŠ± |
| è¿ç»­ç­¾åˆ° | é˜¶æ¢¯å¥–åŠ± | åŸ¹å…»ä¹ æƒ¯ |

#### FR-COMM-003: è¿åŠ¿æ‰“å¡

**æ‰“å¡æœºåˆ¶**:

```
æ¯æ—¥æ‰“å¡
    â”‚
    â”œâ”€â”€ æŸ¥çœ‹ä»Šæ—¥è¿åŠ¿
    â”œâ”€â”€ é€‰æ‹©ä»Šæ—¥å¿ƒæƒ…
    â”œâ”€â”€ è®¾ç½®ä»Šæ—¥ç›®æ ‡ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ ç”Ÿæˆæ‰“å¡å¡ç‰‡
    â””â”€â”€ åˆ†äº«åˆ°åœˆå­

è¿ç»­æ‰“å¡å¥–åŠ±ï¼š
    7 å¤©  â†’ è§£é”ä¸“å±å¤´åƒæ¡†
    30 å¤© â†’ èµ é€ 3 å¤©ä¼šå‘˜
    100 å¤© â†’ å®ä½“ç¤¼å“ï¼ˆå®šåˆ¶æ—¥å†ï¼‰
```

### 3.3.3 æŠ€æœ¯éœ€æ±‚

#### TR-COMM-001: ç¤¾åŒºæ•°æ®æ¨¡å‹

```typescript
// å¸–å­
interface Post {
  id: string;
  authorId: string;
  circleId: string;
  type: 'fortune_share' | 'match_share' | 'question' | 'knowledge' | 'check_in';
  title: string;
  content: string;
  images: string[];
  
  // å…³è”æ•°æ®
  fortuneData?: FortuneData;
  matchData?: MatchData;
  
  // ç»Ÿè®¡
  viewCount: number;
  likeCount: number;
  commentCount: number;
  shareCount: number;
  
  // çŠ¶æ€
  status: 'pending' | 'approved' | 'rejected';
  isPinned: boolean;
  createTime: Date;
  updateTime: Date;
}

// è¯„è®º
interface Comment {
  id: string;
  postId: string;
  authorId: string;
  parentId?: string;  // å›å¤è¯„è®º
  content: string;
  likeCount: number;
  createTime: Date;
}

// ç”¨æˆ·ç§¯åˆ†
interface UserPoints {
  userId: string;
  totalPoints: number;
  history: Array<{
    action: string;
    points: number;
    description: string;
    timestamp: Date;
  }>;
}
```

#### TR-COMM-002: å†…å®¹å®¡æ ¸

```python
class ContentModeration:
    @staticmethod
    async def check_post(post: Post) -> ModerationResult:
        """å†…å®¹å®¡æ ¸"""
        # 1. æ•æ„Ÿè¯æ£€æµ‹
        sensitive_words = await check_sensitive_words(post.content)
        if sensitive_words:
            return ModerationResult(
                approved=False,
                reason=f'åŒ…å«æ•æ„Ÿè¯: {sensitive_words}'
            )
        
        # 2. AI å†…å®¹å®¡æ ¸
        ai_result = await ai_moderation(post.content, post.images)
        if ai_result.risk_score > 0.7:
            return ModerationResult(
                approved=False,
                reason='å†…å®¹å¯èƒ½å­˜åœ¨é£é™©'
            )
        
        # 3. äººå·¥å®¡æ ¸ï¼ˆé«˜é£é™©æˆ–ä¸¾æŠ¥å†…å®¹ï¼‰
        if ai_result.risk_score > 0.3:
            await queue_for_human_review(post)
            return ModerationResult(approved=False, reason='å®¡æ ¸ä¸­')
        
        return ModerationResult(approved=True)
```

### 3.3.4 åŸ‹ç‚¹éœ€æ±‚

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `community_enter` | `{circle_id?: string}` | è¿›å…¥ç¤¾åŒº |
| `community_post_view` | `{post_id: string}` | æŸ¥çœ‹å¸–å­ |
| `community_post_create` | `{type: string, circle_id: string}` | å‘å¸ƒå¸–å­ |
| `community_post_like` | `{post_id: string}` | ç‚¹èµå¸–å­ |
| `community_post_share` | `{post_id: string}` | åˆ†äº«å¸–å­ |
| `community_comment_create` | `{post_id: string}` | å‘è¡¨è¯„è®º |
| `community_check_in` | `{streak: number}` | æ‰“å¡ |

---

# æŠ€æœ¯å®ç°æ–¹æ¡ˆ

## æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ (React PWA)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ æ¸¸å®¢æ¨¡å¼  â”‚ â”‚ æ—¥ç­¾ç”Ÿæˆ  â”‚ â”‚ ä¼šå‘˜ä¸­å¿ƒ  â”‚ â”‚ ç¤¾åŒºåŠŸèƒ½  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API ç½‘å…³ (Vercel)                        â”‚
â”‚         /api/guest/*  /api/card/*  /api/vip/*  /api/communityâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ ¸å¿ƒä¸šåŠ¡æœåŠ¡  â”‚   â”‚   æ”¯ä»˜æœåŠ¡    â”‚   â”‚   AI æœåŠ¡     â”‚
â”‚  (Python)      â”‚   â”‚  (å¾®ä¿¡æ”¯ä»˜)   â”‚   â”‚  (DeepSeek)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Vercel KV  â”‚ â”‚ localStorageâ”‚ â”‚ CDN ç¼“å­˜   â”‚              â”‚
â”‚  â”‚ (ç”¨æˆ·æ•°æ®)  â”‚ â”‚ (æ¸¸å®¢/session)â”‚ â”‚ (æ—¥ç­¾å›¾ç‰‡) â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®å®ç°ç»†èŠ‚

### 1. æ¸¸å®¢æ¨¡å¼å­˜å‚¨æ–¹æ¡ˆ

```typescript
// æ¸¸å®¢æ•°æ®å­˜å‚¨åœ¨ sessionStorage
const GuestStorage = {
  set(data: GuestData) {
    sessionStorage.setItem('guest_data', JSON.stringify(data));
  },
  
  get(): GuestData | null {
    const data = sessionStorage.getItem('guest_data');
    return data ? JSON.parse(data) : null;
  },
  
  clear() {
    sessionStorage.removeItem('guest_data');
  },
  
  // è¿ç§»åˆ°æ­£å¼ç”¨æˆ·
  migrateToUser(userId: string) {
    const data = this.get();
    if (data) {
      localStorage.setItem(`user_${userId}_data`, JSON.stringify(data));
      this.clear();
    }
  }
};
```

### 2. æ—¥ç­¾ç”Ÿæˆæ€§èƒ½ä¼˜åŒ–

```typescript
// ä½¿ç”¨ Web Worker è¿›è¡Œå›¾ç‰‡ç”Ÿæˆ
class CardGenerator {
  private worker: Worker;
  
  constructor() {
    this.worker = new Worker('/workers/card-generator.js');
  }
  
  async generate(options: CardOptions): Promise<Blob> {
    return new Promise((resolve, reject) => {
      this.worker.onmessage = (e) => {
        if (e.data.success) {
          resolve(e.data.blob);
        } else {
          reject(e.data.error);
        }
      };
      
      this.worker.postMessage(options);
    });
  }
}

// æ¨¡æ¿é¢„åŠ è½½
const preloadTemplates = () => {
  const templates = ['ink', 'minimal', 'festive'];
  templates.forEach(async (id) => {
    const template = await fetch(`/templates/${id}.json`).then(r => r.json());
    templateCache.set(id, template);
  });
};
```

### 3. æ¨é€æœåŠ¡å®ç°

```typescript
// Service Worker æ¨é€å¤„ç†
// public/sw.js

self.addEventListener('push', (event) => {
  const data = event.data.json();
  
  const options = {
    body: data.body,
    icon: '/icons/icon-192x192.png',
    badge: '/icons/badge-72x72.png',
    tag: data.type,
    requireInteraction: false,
    actions: data.actions || [],
    data: {
      url: data.url,
      trackingId: data.trackingId
    }
  };
  
  event.waitUntil(
    self.registration.showNotification(data.title, options)
  );
  
  // ä¸ŠæŠ¥æ”¶åˆ°æ¨é€
  self.registration.update();
});

self.addEventListener('notificationclick', (event) => {
  event.notification.close();
  
  const url = event.notification.data.url;
  const trackingId = event.notification.data.trackingId;
  
  // ä¸ŠæŠ¥ç‚¹å‡»
  fetch('/api/push/track', {
    method: 'POST',
    body: JSON.stringify({ trackingId, action: 'click' })
  });
  
  event.waitUntil(
    clients.openWindow(url)
  );
});
```

### 4. ä¼šå‘˜æƒé™æ ¡éªŒ

```typescript
// æƒé™æ ¡éªŒ Hook
function usePermission() {
  const { user, subscription } = useUser();
  
  const checkPermission = useCallback((feature: Feature): PermissionResult => {
    // 1. æ£€æŸ¥ç™»å½•çŠ¶æ€
    if (!user) {
      return { granted: false, reason: 'NOT_LOGGED_IN' };
    }
    
    // 2. æ£€æŸ¥ä¼šå‘˜çŠ¶æ€
    if (!subscription || subscription.status !== 'active') {
      return { granted: false, reason: 'NOT_VIP' };
    }
    
    // 3. æ£€æŸ¥åŠŸèƒ½æƒé™
    const featureConfig = FEATURES[feature];
    if (!featureConfig.allowedPlans.includes(subscription.plan)) {
      return { granted: false, reason: 'PLAN_NOT_SUPPORTED' };
    }
    
    // 4. æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°
    if (featureConfig.monthlyLimit) {
      const usage = user.usage[feature] || 0;
      if (usage >= featureConfig.monthlyLimit) {
        return { granted: false, reason: 'LIMIT_REACHED' };
      }
    }
    
    return { granted: true };
  }, [user, subscription]);
  
  return { checkPermission };
}

// ä½¿ç”¨ç¤ºä¾‹
function AIChatPage() {
  const { checkPermission } = usePermission();
  
  const handleSend = () => {
    const result = checkPermission('AI_CHAT');
    
    if (!result.granted) {
      if (result.reason === 'NOT_VIP') {
        showVipModal();
      } else if (result.reason === 'LIMIT_REACHED') {
        showLimitModal();
      }
      return;
    }
    
    // å‘é€æ¶ˆæ¯
    sendMessage();
  };
}
```

---

# æ•°æ®åŸ‹ç‚¹ä¸æŒ‡æ ‡ä½“ç³»

## æ ¸å¿ƒæŒ‡æ ‡ï¼ˆNorth Starï¼‰

| é˜¶æ®µ | æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|------|--------|------|
| Phase 1 | æ–°ç”¨æˆ·æ¬¡æ—¥ç•™å­˜ç‡ | 45% | æ¸¸å®¢æ¨¡å¼æ ¸å¿ƒç›®æ ‡ |
| Phase 1 | æ—¥ç­¾åˆ†äº«ç‡ | 15% | åˆ†äº«ä¼ æ’­æ•ˆæœ |
| Phase 1 | æ¨é€æ‰“å¼€ç‡ | 15% | æ¨é€æ•ˆæœ |
| Phase 2 | ä»˜è´¹è½¬åŒ–ç‡ | 3% | å•†ä¸šåŒ–èƒ½åŠ› |
| Phase 2 | æœˆä»˜è´¹ç”¨æˆ·(MPU) | 500+ | æ”¶å…¥åŸºç¡€ |
| Phase 2 | åˆç›˜åŠŸèƒ½ä½¿ç”¨ç‡ | 20% | ç¤¾äº¤ä¼ æ’­ |
| Phase 3 | è‡ªç„¶æœç´¢æµé‡å æ¯” | 30% | SEO æ•ˆæœ |
| Phase 3 | AI å’¨è¯¢æ»¡æ„åº¦ | 4.5/5 | æœåŠ¡è´¨é‡ |
| Phase 3 | ç¤¾åŒºç”¨æˆ· 7 æ—¥ç•™å­˜ | 50% | ç¤¾åŒºç²˜æ€§ |

## æŒ‡æ ‡ä½“ç³»åˆ†å±‚

### 1. ç”¨æˆ·è·å–ï¼ˆAcquisitionï¼‰

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ç›®æ ‡æ¥æº |
|------|----------|----------|
| æ–°å¢ç”¨æˆ· | æ¯æ—¥æ–°æ³¨å†Œç”¨æˆ· | è‡ªç„¶æµé‡ã€åˆ†äº«ã€å¹¿å‘Š |
| åˆ†äº«è·å®¢ | é€šè¿‡åˆ†äº«é“¾æ¥æ³¨å†Œçš„ç”¨æˆ· | æ—¥ç­¾åˆ†äº«ã€åˆç›˜åˆ†äº« |
| æœç´¢æµé‡ | æœç´¢å¼•æ“æ¥æºç”¨æˆ· | SEOã€çŸ¥è¯†åº“ |
| è·å®¢æˆæœ¬ | æ€»æ”¯å‡º / æ–°å¢ç”¨æˆ· | å¹¿å‘ŠæŠ•æ”¾ |

### 2. ç”¨æˆ·æ¿€æ´»ï¼ˆActivationï¼‰

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ä¼˜åŒ–æ–¹å‘ |
|------|----------|----------|
| æ¸¸å®¢è½¬åŒ–ç‡ | æ¸¸å®¢æ³¨å†Œæ•° / æ¸¸å®¢æ€»æ•° | æ¸¸å®¢æ¨¡å¼ä¼˜åŒ– |
| é¦–æ¬¡æµ‹ç®—å®Œæˆç‡ | å®Œæˆæµ‹ç®— / å¼€å§‹æµ‹ç®— | æµç¨‹ç®€åŒ– |
| Aha Moment è¾¾æˆ | æŸ¥çœ‹è¿åŠ¿ + æ—¥ç­¾ç”Ÿæˆ | å¼•å¯¼ä¼˜åŒ– |

### 3. ç”¨æˆ·ç•™å­˜ï¼ˆRetentionï¼‰

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ä¼˜åŒ–æ–¹å‘ |
|------|----------|----------|
| æ¬¡æ—¥ç•™å­˜ | æ¬¡æ—¥å›è®¿ / å½“æ—¥æ–°å¢ | æ¨é€ç³»ç»Ÿ |
| 7 æ—¥ç•™å­˜ | 7 æ—¥å›è®¿ / å½“æ—¥æ–°å¢ | å†…å®¹ç”Ÿæ€ |
| 30 æ—¥ç•™å­˜ | 30 æ—¥å›è®¿ / å½“æ—¥æ–°å¢ | ç¤¾åŒºç²˜æ€§ |
| ä¼šå‘˜ç»­è´¹ç‡ | ç»­è´¹ç”¨æˆ· / åˆ°æœŸç”¨æˆ· | ä¼šå‘˜æƒç›Š |

### 4. ç”¨æˆ·æ”¶å…¥ï¼ˆRevenueï¼‰

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ä¼˜åŒ–æ–¹å‘ |
|------|----------|----------|
| ARPU | æ€»æ”¶å…¥ / æ€»ç”¨æˆ·æ•° | å˜ç°ä¼˜åŒ– |
| ARPPU | æ€»æ”¶å…¥ / ä»˜è´¹ç”¨æˆ·æ•° | å®¢å•ä»·æå‡ |
| LTV | ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ | é•¿æœŸç•™å­˜ |
| ä»˜è´¹è½¬åŒ–ç‡ | ä»˜è´¹ç”¨æˆ· / æ€»ç”¨æˆ· | è½¬åŒ–æ¼æ–— |

### 5. ç”¨æˆ·ä¼ æ’­ï¼ˆReferralï¼‰

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ä¼˜åŒ–æ–¹å‘ |
|------|----------|----------|
| åˆ†äº«ç‡ | åˆ†äº«æ¬¡æ•° / æ—¥æ´» | æ—¥ç­¾ä¼˜åŒ– |
| K å› å­ | é‚€è¯·å¸¦æ¥çš„æ–°ç”¨æˆ· / é‚€è¯·è€… | åˆç›˜/PK åŠŸèƒ½ |
| ç—…æ¯’ç³»æ•° | å¹³å‡æ¯ä¸ªç”¨æˆ·å¸¦æ¥æ–°ç”¨æˆ· | ä¼ æ’­æœºåˆ¶ |

## åŸ‹ç‚¹è§„èŒƒ

### äº‹ä»¶å‘½åè§„èŒƒ

```
{æ¨¡å—}_{åŠ¨ä½œ}_{å¯¹è±¡}

ç¤ºä¾‹ï¼š
- guest_enter: è¿›å…¥æ¸¸å®¢æ¨¡å¼
- card_generate_success: æˆåŠŸç”Ÿæˆæ—¥ç­¾
- vip_pay_click: ç‚¹å‡»ä¼šå‘˜æ”¯ä»˜
- ai_chat_message_send: å‘é€ AI å’¨è¯¢æ¶ˆæ¯
```

### å…¬å…±å‚æ•°

æ‰€æœ‰äº‹ä»¶éƒ½éœ€è¦æºå¸¦ï¼š

```typescript
interface CommonParams {
  // ç”¨æˆ·æ ‡è¯†
  user_id?: string;           // æ³¨å†Œç”¨æˆ· ID
  device_id: string;          // è®¾å¤‡ IDï¼ˆæ¸¸å®¢ä¹Ÿç”¨ï¼‰
  session_id: string;         // ä¼šè¯ ID
  
  // ç¯å¢ƒä¿¡æ¯
  platform: 'web' | 'pwa' | 'ios' | 'android';
  version: string;            // App ç‰ˆæœ¬
  timestamp: number;          // äº‹ä»¶æ—¶é—´æˆ³
  
  // åœ°ç†ä½ç½®
  country?: string;
  province?: string;
  city?: string;
}
```

---

# é£é™©æ§åˆ¶ä¸å›æ»šæ–¹æ¡ˆ

## é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| æ¸¸å®¢æ¨¡å¼è½¬åŒ–ç‡ä½ | ä¸­ | é«˜ | A/B æµ‹è¯•å¤šç§å¼•å¯¼æ–‡æ¡ˆå’Œæ—¶æœº |
| ä¼šå‘˜ä»˜è´¹è½¬åŒ–ç‡ä½ | ä¸­ | é«˜ | è°ƒæ•´å®šä»·ç­–ç•¥ï¼Œå¢åŠ å…è´¹è¯•ç”¨ |
| æ¨é€è¢«ç”¨æˆ·å…³é—­ | é«˜ | ä¸­ | ä¼˜åŒ–æ¨é€å†…å®¹ï¼Œå‡å°‘é¢‘ç‡ï¼Œæä¾›ç²¾ç»†è®¾ç½® |
| AI å’¨è¯¢æˆæœ¬è¿‡é«˜ | ä¸­ | é«˜ | é™æµã€ç¼“å­˜å¸¸è§é—®é¢˜å›ç­” |
| ç¤¾åŒºå†…å®¹è¿è§„ | ä¸­ | é«˜ | ä¸¥æ ¼å®¡æ ¸æœºåˆ¶ï¼ŒAI+äººå·¥ |
| æ”¯ä»˜æ¥å£æ•…éšœ | ä½ | é«˜ | å¤šæ”¯ä»˜æ¸ é“å¤‡ä»½ï¼Œæ•…éšœå¿«é€Ÿåˆ‡æ¢ |

## å›æ»šæ–¹æ¡ˆ

### åŠŸèƒ½å¼€å…³

æ‰€æœ‰æ–°åŠŸèƒ½éƒ½é€šè¿‡ Feature Flag æ§åˆ¶ï¼š

```typescript
// åŠŸèƒ½å¼€å…³é…ç½®
const FEATURE_FLAGS = {
  // Phase 1
  guest_mode: { enabled: true, rollout: 100 },
  card_templates: { enabled: true, rollout: 100 },
  push_notification: { enabled: true, rollout: 50 },  // ç°åº¦50%
  
  // Phase 2
  vip_system: { enabled: false, rollout: 0 },
  match_compatibility: { enabled: false, rollout: 0 },
  
  // Phase 3
  knowledge_base: { enabled: false, rollout: 0 },
  ai_upgrade: { enabled: false, rollout: 0 },
  community: { enabled: false, rollout: 0 }
};

// ä½¿ç”¨ç¤ºä¾‹
function GuestMode() {
  const isEnabled = useFeatureFlag('guest_mode');
  
  if (!isEnabled) {
    return null; // åŠŸèƒ½å…³é—­æ—¶ä¸æ¸²æŸ“
  }
  
  return <GuestModeComponent />;
}
```

### å›æ»šè§¦å‘æ¡ä»¶

| åœºæ™¯ | æŒ‡æ ‡é˜ˆå€¼ | å›æ»šåŠ¨ä½œ |
|------|----------|----------|
| æ¸¸å®¢æ¨¡å¼è½¬åŒ–ç‡å¼‚å¸¸ | è½¬åŒ–ç‡ < 5% | å…³é—­æ¸¸å®¢æ¨¡å¼ï¼Œå›æ»šåˆ°åŸæµç¨‹ |
| æ¨é€å…³é—­ç‡è¿‡é«˜ | å…³é—­ç‡ > 30% | æš‚åœæ¨é€ï¼Œä¼˜åŒ–å†…å®¹åé‡è¯• |
| æ”¯ä»˜æˆåŠŸç‡ä½ | æˆåŠŸç‡ < 80% | åˆ‡æ¢æ”¯ä»˜æ¸ é“ï¼Œæ’æŸ¥é—®é¢˜ |
| ç¤¾åŒºè¿è§„å†…å®¹å¤š | è¿è§„ç‡ > 5% | å…³é—­å‘å¸–åŠŸèƒ½ï¼ŒåŠ å¼ºå®¡æ ¸ |
| ç³»ç»Ÿæ€§èƒ½ä¸‹é™ | API å“åº” > 5s | å…³é—­éæ ¸å¿ƒåŠŸèƒ½ï¼Œæ‰©å®¹ |

---

# é™„å½•

## A. æ¥å£æ¸…å•

### Phase 1

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/guest/fortune | GET | è·å–æ¸¸å®¢è¿åŠ¿ |
| /api/card/templates | GET | è·å–æ—¥ç­¾æ¨¡æ¿åˆ—è¡¨ |
| /api/card/generate | POST | ç”Ÿæˆæ—¥ç­¾å›¾ç‰‡ |
| /api/push/subscribe | POST | è®¢é˜…æ¨é€ |
| /api/push/unsubscribe | POST | å–æ¶ˆè®¢é˜… |
| /api/cron/push-morning | GET | æ—©æŠ¥æ¨é€ä»»åŠ¡ |

### Phase 2

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/vip/products | GET | è·å–ä¼šå‘˜å¥—é¤ |
| /api/vip/order/create | POST | åˆ›å»ºè®¢å• |
| /api/vip/order/query | GET | æŸ¥è¯¢è®¢å•çŠ¶æ€ |
| /api/payment/wechat/notify | POST | å¾®ä¿¡æ”¯ä»˜å›è°ƒ |
| /api/match/calculate | POST | è®¡ç®—åˆç›˜ |
| /api/match/share | POST | ç”Ÿæˆåˆç›˜åˆ†äº«å¡ç‰‡ |
| /api/pk/challenge | POST | å‘èµ· PK |

### Phase 3

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /api/kb/articles | GET | æ–‡ç« åˆ—è¡¨ |
| /api/kb/articles/:slug | GET | æ–‡ç« è¯¦æƒ… |
| /api/kb/recommendations | GET | ä¸ªæ€§åŒ–æ¨è |
| /api/ai/chat | POST | AI å’¨è¯¢ |
| /api/ai/memory | GET | è·å– AI è®°å¿† |
| /api/community/circles | GET | åœˆå­åˆ—è¡¨ |
| /api/community/posts | GET/POST | å¸–å­åˆ—è¡¨/å‘å¸ƒ |
| /api/community/posts/:id | GET | å¸–å­è¯¦æƒ… |
| /api/community/posts/:id/like | POST | ç‚¹èµå¸–å­ |
| /api/community/posts/:id/comments | GET/POST | è¯„è®ºåˆ—è¡¨/å‘å¸ƒ |
| /api/community/checkin | POST | æ¯æ—¥æ‰“å¡ |

## B. æ•°æ®åº“è®¾è®¡ï¼ˆVercel KVï¼‰

```
# ç”¨æˆ·æ•°æ®
user:{user_id} â†’ UserProfile
user:{user_id}:subscription â†’ Subscription
user:{user_id}:usage â†’ UsageStats
user:{user_id}:memory â†’ AIMemory

# è®¢å•æ•°æ®
order:{order_id} â†’ Order
user:{user_id}:orders â†’ List<Order>

# ç¤¾åŒºæ•°æ®
post:{post_id} â†’ Post
circle:{circle_id}:posts â†’ List<Post>
user:{user_id}:posts â†’ List<Post>

# çŸ¥è¯†åº“æ•°æ®
article:{slug} â†’ Article
kb:categories â†’ List<Category>
kb:trending â†’ List<Article>

# ç¼“å­˜æ•°æ®
cache:fortune:{user_id}:{date} â†’ FortuneData
cache:guest:{date} â†’ GuestFortune
```

## C. ç¬¬ä¸‰æ–¹æœåŠ¡

| æœåŠ¡ | ç”¨é€” | æ¥å…¥é˜¶æ®µ |
|------|------|----------|
| DeepSeek API | AI å’¨è¯¢ | Phase 1 |
| å¾®ä¿¡æ”¯ä»˜ | æ”¯ä»˜ | Phase 2 |
| æ”¯ä»˜å® | æ”¯ä»˜ | Phase 2 |
| OneSignal / Firebase | æ¨é€ï¼ˆå¤‡é€‰ï¼‰ | Phase 1 |
| Sentry | é”™è¯¯ç›‘æ§ | All |
| Google Analytics | æ•°æ®åˆ†æ | All |

---

**æ–‡æ¡£ç»“æŸ**

*æœ¬æ–‡æ¡£ç”±äº§å“ç»ç†ç¼–å†™ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»äº§å“å›¢é˜Ÿã€‚*
