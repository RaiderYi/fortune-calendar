# -*- coding: utf-8 -*-
"""
地支相关常量
包含地支列表、五行属性、藏干、六冲六合等核心数据
"""

# 十二地支（按序）
DI_ZHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]

# 地支对应五行
DI_ZHI_WUXING = {
    "子": "水", "丑": "土", "寅": "木", "卯": "木",
    "辰": "土", "巳": "火", "午": "火", "未": "土",
    "申": "金", "酉": "金", "戌": "土", "亥": "水"
}

# 地支阴阳属性 (1=阳支, 0=阴支)
DI_ZHI_YINYANG = {
    "子": 1, "丑": 0, "寅": 1, "卯": 0,
    "辰": 1, "巳": 0, "午": 1, "未": 0,
    "申": 1, "酉": 0, "戌": 1, "亥": 0
}

# 地支藏干（本气、中气、余气）
# 本气最强，中气次之，余气最弱
ZHI_CANG_GAN = {
    "子": ("癸", None, None),           # 子藏癸水
    "丑": ("己", "癸", "辛"),            # 丑藏己土、癸水、辛金
    "寅": ("甲", "丙", "戊"),            # 寅藏甲木、丙火、戊土
    "卯": ("乙", None, None),           # 卯藏乙木
    "辰": ("戊", "乙", "癸"),            # 辰藏戊土、乙木、癸水
    "巳": ("丙", "庚", "戊"),            # 巳藏丙火、庚金、戊土
    "午": ("丁", "己", None),            # 午藏丁火、己土
    "未": ("己", "丁", "乙"),            # 未藏己土、丁火、乙木
    "申": ("庚", "壬", "戊"),            # 申藏庚金、壬水、戊土
    "酉": ("辛", None, None),           # 酉藏辛金
    "戌": ("戊", "辛", "丁"),            # 戌藏戊土、辛金、丁火
    "亥": ("壬", "甲", None)             # 亥藏壬水、甲木
}

# 地支六冲
# 子午冲、丑未冲、寅申冲、卯酉冲、辰戌冲、巳亥冲
LIU_CHONG = {
    "子": "午", "午": "子",
    "丑": "未", "未": "丑",
    "寅": "申", "申": "寅",
    "卯": "酉", "酉": "卯",
    "辰": "戌", "戌": "辰",
    "巳": "亥", "亥": "巳"
}

# 地支六合
# 子丑合土、寅亥合木、卯戌合火、辰酉合金、巳申合水、午未合土
LIU_HE = {
    ("子", "丑"): "土",
    ("寅", "亥"): "木",
    ("卯", "戌"): "火",
    ("辰", "酉"): "金",
    ("巳", "申"): "水",
    ("午", "未"): "土"
}

# 地支六合（双向查找版）
LIU_HE_PAIR = {
    "子": "丑", "丑": "子",
    "寅": "亥", "亥": "寅",
    "卯": "戌", "戌": "卯",
    "辰": "酉", "酉": "辰",
    "巳": "申", "申": "巳",
    "午": "未", "未": "午"
}

# 地支三合局
# 申子辰合水局、亥卯未合木局、寅午戌合火局、巳酉丑合金局
SAN_HE = {
    ("申", "子", "辰"): "水",
    ("亥", "卯", "未"): "木",
    ("寅", "午", "戌"): "火",
    ("巳", "酉", "丑"): "金"
}

# 地支三会方
# 寅卯辰会东方木、巳午未会南方火、申酉戌会西方金、亥子丑会北方水
SAN_HUI = {
    ("寅", "卯", "辰"): "木",
    ("巳", "午", "未"): "火",
    ("申", "酉", "戌"): "金",
    ("亥", "子", "丑"): "水"
}

# 地支六害（穿）
LIU_HAI = {
    "子": "未", "未": "子",
    "丑": "午", "午": "丑",
    "寅": "巳", "巳": "寅",
    "卯": "辰", "辰": "卯",
    "申": "亥", "亥": "申",
    "酉": "戌", "戌": "酉"
}

# 地支三刑
# 寅巳申为恃势之刑
# 丑戌未为无恩之刑
# 子卯为无礼之刑
# 辰午酉亥为自刑
SAN_XING = {
    "shi_shi": ("寅", "巳", "申"),    # 恃势之刑
    "wu_en": ("丑", "戌", "未"),      # 无恩之刑
    "wu_li": ("子", "卯"),            # 无礼之刑
    "zi_xing": ("辰", "午", "酉", "亥")  # 自刑
}

# 时辰对照表（小时 -> 地支索引）
# 23-1点为子时，1-3点为丑时...
HOUR_TO_ZHI_INDEX = {
    23: 0, 0: 0,    # 子时
    1: 1, 2: 1,     # 丑时
    3: 2, 4: 2,     # 寅时
    5: 3, 6: 3,     # 卯时
    7: 4, 8: 4,     # 辰时
    9: 5, 10: 5,    # 巳时
    11: 6, 12: 6,   # 午时
    13: 7, 14: 7,   # 未时
    15: 8, 16: 8,   # 申时
    17: 9, 18: 9,   # 酉时
    19: 10, 20: 10, # 戌时
    21: 11, 22: 11  # 亥时
}

# 月令对应地支（节气月）
# 正月寅、二月卯、三月辰...
MONTH_ZHI_INDEX = {
    1: 2,   # 正月 -> 寅
    2: 3,   # 二月 -> 卯
    3: 4,   # 三月 -> 辰
    4: 5,   # 四月 -> 巳
    5: 6,   # 五月 -> 午
    6: 7,   # 六月 -> 未
    7: 8,   # 七月 -> 申
    8: 9,   # 八月 -> 酉
    9: 10,  # 九月 -> 戌
    10: 11, # 十月 -> 亥
    11: 0,  # 冬月 -> 子
    12: 1   # 腊月 -> 丑
}


def get_dizhi_index(zhi: str) -> int:
    """获取地支索引"""
    return DI_ZHI.index(zhi)


def get_dizhi_by_index(index: int) -> str:
    """根据索引获取地支"""
    return DI_ZHI[index % 12]


def get_dizhi_wuxing(zhi: str) -> str:
    """获取地支的五行属性"""
    return DI_ZHI_WUXING.get(zhi)


def get_cang_gan(zhi: str) -> tuple:
    """获取地支藏干"""
    return ZHI_CANG_GAN.get(zhi, (None, None, None))


def get_ben_qi(zhi: str) -> str:
    """获取地支本气（藏干第一位）"""
    cang = ZHI_CANG_GAN.get(zhi)
    return cang[0] if cang else None


def check_liu_chong(zhi1: str, zhi2: str) -> bool:
    """检查两地支是否六冲"""
    return LIU_CHONG.get(zhi1) == zhi2


def check_liu_he(zhi1: str, zhi2: str) -> bool:
    """检查两地支是否六合"""
    return LIU_HE_PAIR.get(zhi1) == zhi2


def get_hour_zhi_index(hour: int) -> int:
    """根据小时获取时辰地支索引"""
    return ((hour + 1) // 2) % 12
